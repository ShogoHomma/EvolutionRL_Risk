---
title: "Figures for Paper"
author: "Shogo Homma"
date: "`r format(Sys.time(), '%Y/%m/%d')`"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
    toc_depth: 2
    theme: spacelab
    highlight: haddock
    fig_caption: yes
    fig_width: 9
    fig_height: 8
    self_contained: true
    css: mystyle.css
    md_extensions: -ascii_identifiers
---


# セットアップ

```{r, load-library}
library(tidyverse)
library(here)
library(data.table)
#library(GGally)
library(ggrepel)
library(patchwork)
```

```{r}
# 画像の保存先のパスを設定
output_path <- here("Output", "FiguresForPaper")
```


```{r setup knit_environment, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, comment="", warning=FALSE, message=FALSE, fig.align="center", cache=F)
```


## 関数の読み込み

```{r}
common_functions_path <- here("Analysis_Script", "_functions_common")
common_functions <- here(common_functions_path, dir(common_functions_path))
purrr::walk(common_functions, ~source(.x))

project_functions_path <- here("Analysis_Script", "_functions_project")
project_functions <- here(project_functions_path, dir(project_functions_path))
purrr::walk(project_functions, ~source(.x))
```


## データの取得

### 単一課題のデータ

```{r}
## 世代平均の情報についてのデータ
### 末尾の_40_5はシュア選択肢の利得構造を表す


# pattern_name_40_5 <- c(
#   "_20200129110012", "_20200129110013", "_20190916204013", "_20200129110014", "_20200129110015")
# 
# sim_name_40_5 <- c(
#   "40.5.20.30", "40.5.20.25", "40.5.20.20", "40.5.20.15", "40.5.20.10")


pattern_name_30_5 <- c(
  "_20191214183504", "_20191214183505", "_20191214183506", "_20191214183507", "_20191214183508",
  "_20191216111051", "_20191216111052", "_20191216111053", "_20191216111054", "_20191216111055",
  "_20191217145232", "_20191217145233", "_20191217145234", "_20191217145235", "_20191217145236",
  "_20191218152742", "_20191218152743", "_20191218152744", "_20191218152745", "_20191218152746")

sim_name_30_5 <- c(
  "30.5.50.30", "30.5.50.25", "30.5.50.20", "30.5.50.15", "30.5.50.10", 
  "30.5.40.30", "30.5.40.25", "30.5.40.20", "30.5.40.15", "30.5.40.10", 
  "30.5.20.30", "30.5.20.25", "30.5.20.20", "30.5.20.15", "30.5.20.10", 
  "30.5.10.30", "30.5.10.25", "30.5.10.20", "30.5.10.15", "30.5.10.10")

pattern_name_20_5 <- c(
  "_20191119144338", "_20191118142201", "_20190916204328", "_20191118142145", "_20191118142115",
  "_20191223104741", "_20191223104742", "_20191223104743", "_20191223104744", "_20191223104745",
  "_20200110152317", "_20200110152318", "_20200110152319", "_20200110152320", "_20200110152321",
  "_20191219134742", "_20191224122806", "_20190916204119", "_20191224122807", "_20191220110720")

sim_name_20_5 <- c(
  "20.5.40.30", "20.5.40.25", "20.5.40.20", "20.5.40.15", "20.5.40.10",
  "20.5.30.30", "20.5.30.25", "20.5.30.20", "20.5.30.15", "20.5.30.10", 
  "20.5.10.30", "20.5.10.25", "20.5.10.20", "20.5.10.15", "20.5.10.10",
  "20.5.0.30", "20.5.0.25", "20.5.0.20", "20.5.0.15", "20.5.0.10")

pattern_name_10_5 <- c(
  "_20191225105829", "_20191225105830", "_20191225105831", "_20191225105832", "_20191226115412",
  "_20200111161131", "_20200111161132", "_20200111161133", "_20200111161134", "_20200111161135", 
  "_20200113142323", "_20200113142324", "_20200113142325", "_20200113142326", "_20200113142327",
  "_20191226115336", "_20191226115337", "_20191226115338", "_20191226115339", "_20191227142311")

sim_name_10_5 <- c(
  "10.5.30.30", "10.5.30.25", "10.5.30.20", "10.5.30.15", "10.5.30.10",
  "10.5.20.30", "10.5.20.25", "10.5.20.20", "10.5.20.15", "10.5.20.10",
  "10.5.0.30", "10.5.0.25", "10.5.0.20", "10.5.0.15", "10.5.0.10",
  "10.5.-10.30", "10.5.-10.25", "10.5.-10.20", "10.5.-10.15", "10.5.-10.10")

pattern_name_0_5 <- c(
  "_20191121180423", "_20191121180252", "_20190916204538", "_20191121180225", "_20191121180208",
  "_20200114122539", "_20200114122540", "_20200114122541", "_20200114122542", "_20200114122543",
  "_20200115150219", "_20200115150220", "_20200115150221", "_20200115150222", "_20200115150223", 
  "_20191224123053", "_20191224123054", "_20190916204210", "_20191224123055", "_20191225105953")

sim_name_0_5 <- c(
  "0.5.20.30", "0.5.20.25", "0.5.20.20", "0.5.20.15", "0.5.20.10",
  "0.5.10.30", "0.5.10.25", "0.5.10.20", "0.5.10.15", "0.5.10.10",
  "0.5.-10.30", "0.5.-10.25", "0.5.-10.20", "0.5.-10.15", "0.5.-10.10",
  "0.5.-20.30", "0.5.-20.25", "0.5.-20.20", "0.5.-20.15", "0.5.-20.10")

pattern_name_minus10_5 <- c(
  "_20191227142546", "_20191227142547", "_20191227142548", "_20191227142549", "_20191228112810",
  "_20200116170128", "_20200116170129", "_20200116170130", "_20200116170131", "_20200116170132",
  "_20200118155206", "_20200118155207", "_20200118155208", "_20200118155209", "_20200118155210",
  "_20191228112846", "_20191228112847", "_20191228112848", "_20191228112849", "_20191228184927")

sim_name_minus10_5 <- c(
  "-10.5.10.30", "-10.5.10.25", "-10.5.10.20", "-10.5.10.15", "-10.5.10.10",
  "-10.5.0.30", "-10.5.0.25", "-10.5.0.20", "-10.5.0.15", "-10.5.0.10",
  "-10.5.-20.30", "-10.5.-20.25", "-10.5.-20.20", "-10.5.-20.15", "-10.5.-20.10",
  "-10.5.-30.30", "-10.5.-30.25", "-10.5.-30.20", "-10.5.-30.15", "-10.5.-30.10")

pattern_name_minus20_5 <- c(
  "_20191219130414", "_20191219130415", "_20190916204750", "_20191219130416", "_20191219130417",
  "_20191221121729", "_20191221121730", "_20191221121731", "_20191221121732", "_20191221121733",
  "_20191222102255", "_20191222102256", "_20191222102257", "_20191222102258", "_20191222102259",
  "_20191220110603", "_20191220110604", "_20191114220026", "_20191220110605", "_20191220110606")

sim_name_minus20_5 <- c(
  "-20.5.0.30", "-20.5.0.25", "-20.5.0.20", "-20.5.0.15", "-20.5.0.10",
  "-20.5.-10.30", "-20.5.-10.25", "-20.5.-10.20", "-20.5.-10.15", "-20.5.-10.10",
  "-20.5.-30.30", "-20.5.-30.25", "-20.5.-30.20", "-20.5.-30.15", "-20.5.-30.10",
  "-20.5.-40.30", "-20.5.-40.25", "-20.5.-40.20", "-20.5.-40.15", "-20.5.-40.10")

pattern_name_minus30_5 <- c(
  "_20191229191133", "_20191229191134", "_20191229191135", "_20191229191136", "_20191229191137",
  "_20220104104342", "_20220104104343", "_20220104104344", "_20220104104345", "_20220104104346", 
  #"_20220322151600", "_20220322151601", "", "", "", 
  "_20211230173101", "_20211230173102", "_20211230173103", "_20211230173104", "_20211230173105")

sim_name_minus30_5 <- c(
  "-30.5.-10.30", "-30.5.-10.25", "-30.5.-10.20", "-30.5.-10.15", "-30.5.-10.10",
  "-30.5.-20.30", "-30.5.-20.25", "-30.5.-20.20", "-30.5.-20.15", "-30.5.-20.10",
  "-30.5.-50.30", "-30.5.-50.25", "-30.5.-50.20", "-30.5.-50.15", "-30.5.-50.10")

```


```{r}
# 以上を一つのリストにまとめる

params <- list(
  pattern_name = c(pattern_name_30_5, pattern_name_20_5, pattern_name_10_5, pattern_name_0_5, pattern_name_minus10_5, pattern_name_minus20_5, pattern_name_minus30_5),
  sim_name = c(sim_name_30_5, sim_name_20_5, sim_name_10_5, sim_name_0_5, sim_name_minus10_5, sim_name_minus20_5, sim_name_minus30_5)
  )

# 世代情報のdfを作成
DataDir <- "Data"
DataDir_sub <- "Evo_Sim_SingleTask"

df_gene <- purrr::map2_dfr(params$pattern_name, params$sim_name, ~MakeDf(.x, .y, DataDir, DataDir_sub, "_gene.csv"))
df_gene_longer <- ConvertDfGeneLonger_MeanSD(df_gene)

discrim <- unique(df_gene_longer$discriminability)
```


```{r}
# 上記のベクトルを削除
rm(list = ls()[stringr::str_starts(string = ls(), pattern = "pattern_name")])
rm(list = ls()[stringr::str_starts(string = ls(), pattern = "sim_name")])
```


```{r}
# GeneAverageのデータだけ集める

params <- list(
  pattern_name = c(pattern_name_30_5, pattern_name_20_5, pattern_name_10_5, pattern_name_0_5, pattern_name_minus10_5, pattern_name_minus20_5, pattern_name_minus30_5),
  sim_name = c(sim_name_30_5, sim_name_20_5, sim_name_10_5, sim_name_0_5, sim_name_minus10_5, sim_name_minus20_5, sim_name_minus30_5)
  )

# dfを作成
DataDir <- "Data"
DataDir_sub <- "Evo_Sim_SingleTask"

df_gene_riskaversion <- 
  purrr::map2_dfr(params$pattern_name, params$sim_name, ~MakeDf(.x, .y, DataDir, DataDir_sub, "GeneAverage_"))

df_gene_riskaversion_mean <- 
  df_gene_riskaversion %>% 
  dplyr::group_by(sim, generation) %>% 
  dplyr::summarise(
    mean_choice1 = mean(MEAN_rate_choice1),
    sd_choice1 = mean(SD_rate_choice1)
  ) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(
    mean_risk_aversion = 1 - mean_choice1
  ) %>% # 以下、選択肢の効果量についての処理をする
  tidyr::separate(col = "sim", into = c("m2", "sd2", "m1", "sd1"), sep = "\\.", remove = FALSE) %>% 
  dplyr::mutate(
    m1 = as.integer(m1),
    sd1 = as.integer(sd1),
    m2 = as.integer(m2),
    sd2 = as.integer(sd2)
  ) %>% 
  dplyr::mutate(
    discriminability = EffectSize(m1, sd1, m2, sd2),
    task_exp = paste(m1, " vs ", m2, sep = "")
  ) %>% 
  dplyr::arrange(desc(discriminability))

```


### 単一課題（1世代内データ）を集める

```{r}
# 世代内データを集める（ヒートマップ作成のため）

# pattern_name_40_5 <- c(
#   "_20201227195517", "_20201227195518", "_20191023141706", "_20201227195519", "_20201227202535"
#   )
# 
# sim_name_40_5 <- c(
#   "40.5.20.30", "40.5.20.25", "40.5.20.20", "40.5.20.15", "40.5.20.10")


pattern_name_30_5 <- c(
  "_20201227183815", "_20201227191810", "_20201227191811", "_20201227191812", "_20201227191813",
  "_20201227183031", "_20201227183152", "_20201227183354", "_20201227183600", "_20201227183713"
  )

sim_name_30_5 <- c(
  "30.5.50.30", "30.5.50.25", "30.5.50.20", "30.5.50.15", "30.5.50.10",
  "30.5.10.30", "30.5.10.25", "30.5.10.20", "30.5.10.15", "30.5.10.10")

pattern_name_20_5 <- c(
  "_20191229145232", "_20191229145233", "_20191023105942", "_20191229145234", "_20191229145235",
  "_20191229152907", "_20191229152908", "_20191023145842", "_20191229152909", "_20191229152910"
  )

sim_name_20_5 <- c(
  "20.5.40.30", "20.5.40.25", "20.5.40.20", "20.5.40.15", "20.5.40.10",
  "20.5.0.30", "20.5.0.25", "20.5.0.20", "20.5.0.15", "20.5.0.10")

pattern_name_10_5 <- c(
  "_20200108205820", "_20200108205821", "_20200108205822", "_20200108205823", "_20200108205824",
  "_20200109143326", "_20200109143327", "_20200109143328", "_20200109143329", "_20200109143330"
  )

sim_name_10_5 <- c(
  "10.5.30.30", "10.5.30.25", "10.5.30.20", "10.5.30.15", "10.5.30.10",
  "10.5.-10.30", "10.5.-10.25", "10.5.-10.20", "10.5.-10.15", "10.5.-10.10")

pattern_name_0_5 <- c(
  "_20191229161041", "_20191229161042", "_20191023141508", "_20191229161043", "_20191229161044",
  "_20191229164648", "_20191229164649", "_20191023145854", "_20191229164650", "_20191229164651"
  )

sim_name_0_5 <- c(
  "0.5.20.30", "0.5.20.25", "0.5.20.20", "0.5.20.15", "0.5.20.10",
  "0.5.-20.30", "0.5.-20.25", "0.5.-20.20", "0.5.-20.15", "0.5.-20.10")

pattern_name_minus10_5 <- c(
  "_20200109152359", "_20200109152360", "_20200109152361", "_20200109152362", "_20200109152363",
  "_20200109161034", "_20200109161035", "_20200109161036", "_20200109161037", "_20200109161038"
  )

sim_name_minus10_5 <- c(
  "-10.5.10.30", "-10.5.10.25", "-10.5.10.20", "-10.5.10.15", "-10.5.10.10",
  "-10.5.-30.30", "-10.5.-30.25", "-10.5.-30.20", "-10.5.-30.15", "-10.5.-30.10")

pattern_name_minus20_5 <- c(
  "_20191229172653", "_20191229172654", "_20191023141626", "_20191229172655", "_20191229172656",
  "_20191229181936", "_20191229181937", "_20191229181938", "_20191229181939", "_20191229181940"
  )

sim_name_minus20_5 <- c(
  "-20.5.0.30", "-20.5.0.25", "-20.5.0.20", "-20.5.0.15", "-20.5.0.10",
  "-20.5.-40.30", "-20.5.-40.25", "-20.5.-40.20", "-20.5.-40.15", "-20.5.-40.10")

pattern_name_minus30_5 <- c(
  "_20201227192101", "_20201227192253", "_20201227195149", "_20201227195150", "_20201227195151",
  "_20220323182716", "_20220323182717", "_20220323182718", "_20220323182719", "_20220323182720"
  )

sim_name_minus30_5 <- c(
  "-30.5.-10.30", "-30.5.-10.25", "-30.5.-10.20", "-30.5.-10.15", "-30.5.-10.10",
  "-30.5.-50.30", "-30.5.-50.25", "-30.5.-50.20", "-30.5.-50.15", "-30.5.-50.10"
  )

# 以上を一つのリストにまとめる

params <- list(
  pattern_name = c(pattern_name_30_5, pattern_name_20_5, pattern_name_10_5, pattern_name_0_5, pattern_name_minus10_5, pattern_name_minus20_5, pattern_name_minus30_5),
  sim_name = c(sim_name_30_5, sim_name_20_5, sim_name_10_5, sim_name_0_5, sim_name_minus10_5, sim_name_minus20_5, sim_name_minus30_5)
  )

# 上記のベクトルを削除
rm(list = ls()[stringr::str_starts(string = ls(), pattern = "pattern_name")])
rm(list = ls()[stringr::str_starts(string = ls(), pattern = "sim_name")])

# dfを作成
DataDir <- "Data"
DataDir_sub <- "WithinGeneration_Sim_SingleTask"

df_withingene <- purrr::map2_dfr(params$pattern_name, params$sim_name, ~MakeDfWithinGene(.x, .y, DataDir, DataDir_sub, "_nat.csv"))
```


### 複数課題のデータ

```{r}
## 世代平均の情報について
## いったん、9つのシミュレーションを取り出す

# pattern_name <- c("_20200604093559", "_20200604094009", "_20200604094228", "_20200613192231", "_20200613192352", "_20200613192639", "_20201214135554", "_20200618202649", "_20200618202802") # old directory

pattern_name <- c("_20210201113232", "_20210204145614", "_20210204170716", "_20210209094209", "_20210209105123", "_20210215150639", "_20210215150804", "_20210219095243", "_20210219095637")

sim_name <- c("P_2/2", "P_1/3", "P_3/1", "C_2/2", "C_1/3", "C_3/1", "N_2/2", "N_1/3", "N_3/1")


params <- 
  list(
    pattern_name = pattern_name,
    sim_name = sim_name
  )

# 世代情報のdfを作成
DataDir <- "Data"
DataDir_sub <- "Evo_Sim_MultipleTask"

df_gene_multi <- purrr::map2_dfr(params$pattern_name, params$sim_name, ~MakeDf(.x, .y, DataDir, DataDir_sub, "_gene.csv")) %>% 
  tidyr::separate(col = sim, into = c("loc", "task_config"), sep = "_", remove = FALSE)

# 縦長に
df_gene_multi_longer <- 
  df_gene_multi %>% 
  dplyr::select(sim, loc, task_config, replication, generation, mean_ap, mean_an, mean_bt, sd_ap, sd_an, sd_bt) %>% 
dplyr::rename(
    MEAN_ap = mean_ap,
    MEAN_an = mean_an,
    MEAN_bt = mean_bt,
    SD_ap = sd_ap,
    SD_an = sd_an,
    SD_bt = sd_bt,
  ) %>%
  tidyr::pivot_longer(c(-sim, -loc, -task_config, -generation, -replication), names_to = c("statistics", "para"), values_to = 'value', names_sep = "_") %>%
  tidyr::pivot_wider(names_from = statistics, values_from = value) %>% 
  dplyr::group_by(sim, loc, task_config, generation, para) %>%
  dplyr::summarise(
    mean_rate = mean(MEAN), # Replicationに関して平均をとる
    sd_rate = mean(SD)) %>% 
  dplyr::ungroup()
```


```{r}
## 世代, 課題平均の情報について（TaskGeneAverage）
## いったん、9つのシミュレーションを取り出す

# pattern_name <- c("_20200604093559", "_20200604094009", "_20200604094228", "_20200613192231", "_20200613192352", "_20200613192639", "_20201214135554", "_20200618202649", "_20200618202802") # old directory

pattern_name <- c("_20210201113232", "_20210204145614", "_20210204170716", "_20210209094209", "_20210209105123", "_20210215150639", "_20210215150804", "_20210219095243", "_20210219095637")

sim_name <- c("P_2/2", "P_1/3", "P_3/1", "C_2/2", "C_1/3", "C_3/1", "N_2/2", "N_1/3", "N_3/1")

params <- 
  list(
    pattern_name = pattern_name,
    sim_name = sim_name
  )

# dfを作成
DataDir <- "Data"
DataDir_sub <- "Evo_Sim_MultipleTask"

df_gene_task_multi <- purrr::map2_dfr(params$pattern_name, params$sim_name, ~MakeDf(.x, .y, DataDir, DataDir_sub, "TaskGeneAverage_"))

df_gene_task_riskaversion <-
  df_gene_task_multi %>% 
  dplyr::group_by(sim, generation, task) %>% # Replicationについて平均をとる
  dplyr::summarise(
    mean_choice1 = mean(MEAN_rate_choice1),
    sd_choice1 = mean(SD_rate_choice1)
  ) %>% 
  dplyr::ungroup() %>% 
  dplyr::mutate(
    mean_risk_aversion = 1 - mean_choice1
  )

```


```{r, eval = FALSE}
## 試行情報について（_trial）
## 複数課題シミュレーションの、第1世代と最終世代だけ、試行データを取り出す
## データが多いので、シミュレーション1.0, 4.0, 7.0だけのデータを読み込む
## -> このchunckの方法は使わない

# pattern_name <- c("_20210201113232", "_20210204145614", "_20210204170716", "_20210209094209", "_20210209105123", "_20210215150639", "_20210215150804", "_20210219095243", "_20210219095637")

pattern_name <- c("_20210201113232", "_20210209094209", "_20210215150804")

sim_name <- c("multi1.0", "multi4.0", "multi7.0")

params <- 
  list(
    pattern_name = pattern_name,
    sim_name = sim_name
  )

#df_trial <- purrr::map2_dfr(params$pattern_name, params$sim_name, ~MakeDfTrial_meanSD())
```

```{r}
## 上の方法では読み込みが遅いので、1つずつdfにする
DataDir <- "Data"
DataDir_sub <- "Evo_Sim_MultipleTask"

df_trialP22_meanSD <- MakeDfTrial_meanSD("_20210201113232", "P_2/2", DataDir, DataDir_sub, "_trial.csv.gz")
# Warning in mean.default(p) :
#  argument is not numeric or logical: returning NA ← たまに出るwarning
```


```{r}
# DataDir <- "Data"
# DataDir_sub <- "Evo_Sim_MultipleTask"
# 
# df_trial4.0_meanSD <- MakeDfTrial_meanSD("_20210209094209", "multi4.0", DataDir, DataDir_sub, "_trial.csv.gz")
```


```{r}
DataDir <- "Data"
DataDir_sub <- "Evo_Sim_MultipleTask"

df_trialN22_meanSD <- MakeDfTrial_meanSD("_20210215150804", "N_2/2", DataDir, DataDir_sub, "_trial.csv.gz")
```


### ランダム複数課題シミュレーション


```{r}
# taskinfo系のdataframeを作成

pattern_name <- c("_20220905162206", "_20220909161625", "_20220919103516", "_20220921105827", "_20220923105509")
sim_name <- c("cond_2/2", "cond_1/3", "cond_3/1", "cond_0/4", "cond_4/0")

params <- list(
  pattern_name = pattern_name,
  sim_name = sim_name
)

DataDir <- "Data"
DataDir_sub <- "Evo_RandMultiTask"


df_randmulti_taskinfo <- 
  purrr::map2_dfr(params$pattern_name, params$sim_name, ~MakeDf(.x, .y, DataDir, DataDir_sub, "_task.csv")) %>% 
  dplyr::mutate(
    area_rate = (pnorm(0, m1, sd1) + pnorm(0, m2, sd2))/2,
    eff_size = EffectSize(m1, sd1, m2, sd2)
    ) %>% 
  dplyr::mutate(
    posi_nega = case_when(
      (m1 > 0) & (m2 > 0) ~ "posi",
      (m1 < 0) & (m2 < 0) ~ "nega",
      TRUE ~ "other"
    ),
    task_type = case_when(
      m1 > m2 ~ "risk_seeking",
      m2 > m1 ~ "risk_aversion"
    ))

df_randmulti_taskgroup <- 
  purrr::map2_dfr(params$pattern_name, params$sim_name, ~MakeDf(.x, .y, DataDir, DataDir_sub, "_taskgroup.csv")) %>% 
  dplyr::mutate(area_rate = (pnorm(0, m1, sd1) + pnorm(0, m2, sd2))/2) %>% 
  dplyr::mutate(
    posi_nega = case_when(
      (m1 > 0) & (m2 > 0) ~ "posi",
      (m1 < 0) & (m2 < 0) ~ "nega",
      TRUE ~ "other"
    ),
    task_type = case_when(
      m1 > m2 ~ "risk_seeking",
      m2 > m1 ~ "risk_aversion"
    ))

# 各課題の平均的な効果量と負の領域量を計算
df_randmulti_taskinfo %>% 
  dplyr::group_by(sim, sim_i) %>% 
  dplyr::summarise(
    mean_eff_size = mean(eff_size),
    mean_area_rate = mean(area_rate)
  ) ->
  df_randmulti_mean_taskinfo
```


```{r}
# _gene.csv # N = 1,000のもの 
pattern_name <- c("_20220905162206", "_20220909161625", "_20220919103516", "_20220921105827", "_20220923105509")
sim_name <- c("cond_2/2", "cond_1/3", "cond_3/1", "cond_0/4", "cond_4/0")

params <- list(
  pattern_name = pattern_name,
  sim_name = sim_name
)

DataDir <- "Data"
DataDir_sub <- "Evo_RandMultiTask"

df_gene_randmulti <- purrr::map2_dfr(params$pattern_name, params$sim_name, ~MakeDf(.x, .y, DataDir, DataDir_sub, "_gene.csv"))

df_gene_randmulti %>% 
  dplyr::group_by(sim, generation) %>% 
  dplyr::summarise(
    MEAN_ap = mean(mean_ap),
    MEAN_an = mean(mean_an),
    MEAN_bt = mean(mean_bt)
  ) -> 
  df_gene_randmulti_summary



# 課題情報と遺伝子のdfと結合
df_gene_randmulti %>% 
  dplyr::filter(generation == 2999) %>% 
  dplyr::full_join(df_randmulti_mean_taskinfo, by = c("sim", "sim_i")) ->
  df_gene_randmulti_taskinfo


# 全体のまとめで使用するdfを作成
df_gene_randmulti %>% 
  dplyr::group_by(sim, generation) %>% 
  dplyr::summarise(
    MEAN_ap = mean(mean_ap),
    MEAN_an = mean(mean_an),
    MEAN_bt = mean(mean_bt)
  ) %>% 
  tidyr::pivot_longer(cols = -c(sim, generation), names_to = c("stat", "para"), names_sep = "_") %>% 
  tidyr::pivot_wider(names_from = stat, values_from = value) -> 
  df_gene_randmulti_summary_longer

df_gene_randmulti %>% 
  tidyr::pivot_longer(cols = -c(sim, sim_i, generation), names_to = c("stat", "para"), names_sep = "_") %>% 
  tidyr::pivot_wider(names_from = stat, values_from = value) ->
  df_gene_randmulti_longer

df_gene_randmulti_longer %>% 
  dplyr::filter(generation == 2999) %>% 
  dplyr::full_join(df_randmulti_mean_taskinfo, by = c("sim", "sim_i")) ->
  df_gene_randmulti_taskinfo_longer
```



```{r, eval=FALSE}
# _nat.csvについて

# ------ 5種類のシミュレーション ------ #
# 時間がかかるので実行しない方がいい
# 下のRDSファイルの読み込みをした方がいい

pattern_name <- c("_20220905162206", "_20220909161625", "_20220919103516", "_20220921105827", "_20220923105509")
sim_name <- c("cond_2/2", "cond_1/3", "cond_3/1", "cond_0/4", "cond_4/0")

DataDir <- "Data"
DataDir_sub <- "Evo_RandMultiTask"

AgentN <- 1000
GeneN <- 3000
TaskN <- 4
Extract_SimN <- 100

df_agent_randmulti <- purrr::map2_dfr(pattern_name, sim_name, ~MakeDfNat_Rand(.x, .y, DataDir, DataDir_sub, "_nat.csv.gz", GeneN, AgentN, TaskN, Extract_SimN))

df_agent_randmulti %>%
  dplyr::group_by(sim, sim_i, task_i, generation) %>%
  dplyr::summarise(
    MEAN_payoff = mean(mean_payoff),
    SD_payoff = sqrt(variance(mean_payoff)),
    MEAN_rate_choice1 = mean(rate_choice1),
    SD_rate_choice1 = sqrt(variance(rate_choice1))
  ) %>%
  dplyr::mutate(
    mean_risk_aversion = 1 - MEAN_rate_choice1
  ) ->
  df_agent_randmulti_summary

# saveRDS(df_agent_randmulti_summary, file = "./Data/Evo_RandMultiTask/df_agent_randmulti_summary.obj")

```

```{r}
#  ------ # _nat.csv：続き ------ #

df_agent_randmulti_summary <- readRDS(here("Data", "Evo_RandMultiTask", "df_agent_randmulti_summary.obj"))

# 課題情報と結合する
df_randmulti_taskinfo %>%
  dplyr::full_join(df_agent_randmulti_summary, by = c("sim", "sim_i", "task_i")) ->
  df_agent_randmulti_summary

df_agent_randmulti_summary %>%
  dplyr::group_by(sim, generation, task_type) %>%
  dplyr::summarise(
    MEAN_risk_aversion = mean(mean_risk_aversion),
    SD_risk_aversion = sqrt(variance(mean_risk_aversion)),
    N = n()
  ) %>% 
  dplyr::mutate(
    sim_n = sim %>% str_replace(pattern = "cond_", replacement = "risk seeking/aversion = ")
  ) ->
  df_agent_randmulti_simMEAN
```


```{r, eval=FALSE}
# _trial.csv.gz # N = 1,000のもの 

# ------ 5種類のシミュレーション ------ #
# 時間がかかるので実行しない方がいい
# 下のRDSファイルの読み込みをした方がいい


pattern_name <- c("_20220905162206", "_20220909161625", "_20220919103516", "_20220921105827", "_20220923105509")
sim_name <- c("cond_2/2", "cond_1/3", "cond_3/1", "cond_0/4", "cond_4/0")

DataDir <- "Data"
DataDir_sub <- "Evo_RandMultiTask"

Extract_SimN <- 100

df_trial_randmulti_summary <- purrr::map2_dfr(pattern_name, sim_name, ~MakeDfTrial_Rand(.x, .y, DataDir, DataDir_sub, "_trial.csv.gz", Extract_SimN))

# 課題情報と結合する
df_randmulti_taskinfo %>%
  dplyr::full_join(df_trial_randmulti_summary, by = c("sim", "sim_i", "task_i")) %>% 
  dplyr::mutate(
    sim_n = sim %>% str_replace(pattern = "cond_", replacement = "risk seeking/aversion = ")
  ) -> 
  df_trial_randmulti_summary

#saveRDS(df_trial_randmulti_summary, file = "./Data/Evo_RandMultiTask/df_trial_randmulti_summary.obj")
```

```{r}
# _trial.csv.gz：続き ------ #

df_trial_randmulti_summary <- readRDS(here("Data", "Evo_RandMultiTask", "df_trial_randmulti_summary.obj"))

df_trial_randmulti_summary %>% 
  dplyr::group_by(sim_n, generation, trial, task_type) %>% # sim_i間の平均とSDを計算する
  dplyr::summarise(
    MEAN_risk_aversion = mean(mean_risk_aversion),
    SD_risk_aversion = sqrt(variance(mean_risk_aversion)) # sim_i間のSD
  ) -> 
df_trial_randmulti_simMEAN
```


### 期待値が同じ課題のデータ

```{r}
load(here("Data", "SameExp_Sim", "res_ql.RData"))

# load(here("Data", "SameExp_Sim", "0Archive_20210225", "res_ql.RData")) # old data: multiTask 1 ~ 6
# load(here("Data", "SameExp_Sim", "0Archive_20210225", "res_ql2.RData")) # old data: multiTask 7 ~ 9
```


```{r}
# pattern_name <- c("_20200604093559", "_20200604094009", "_20200604094228", "_20200613192231", "_20200613192352", "_20200613192639", "_20201214135554", "_20200618202649", "_20200618202802") # old directory

pattern_name <- c("_20210201113232", "_20210204145614", "_20210204170716", "_20210209094209", "_20210209105123", "_20210215150639", "_20210215150804", "_20210219095243", "_20210219095637")

sim_name <- c("multi1.0", "multi2.0", "multi3.0", "multi4.0", "multi5.0", "multi6.0", "multi7.0", "multi8.0", "multi9.0")

params <- 
  list(
    pattern_name = pattern_name,
    sim_name = sim_name
  )

# まず最終世代の遺伝子情報を取り出す
DataDir <- "Data"
DataDir_sub <- "Evo_Sim_MultipleTask"

df_lastgene_list <- purrr::map2(params$pattern_name, params$sim_name, ~MakeDfLastGene_multiTask(.x, .y, DataDir, DataDir_sub, "first_lastgene.csv"))

# 期待値が同じ課題のシミュレーションを整理する　# とりあえず multi1.0とmulti4.0とmultiと7.0

res_ql_1 <- list(res_ql_1_1, res_ql_1_3, res_ql_1_5, res_ql_1_7)
choice_result_1 <- purrr::map(res_ql_1, ~MakeDf_ChoiceResult(.x, df_lastgene_list[[1]]))

res_ql_4 <- list(res_ql_4_1, res_ql_4_3, res_ql_4_5, res_ql_4_7)
choice_result_4 <- purrr::map(res_ql_4, ~MakeDf_ChoiceResult(.x, df_lastgene_list[[4]]))

res_ql_7 <- list(res_ql_7_1, res_ql_7_3, res_ql_7_5, res_ql_7_7)
choice_result_7 <- purrr::map(res_ql_7, ~MakeDf_ChoiceResult(.x, df_lastgene_list[[7]]))

rm(list = ls()[stringr::str_detect(string = ls(), pattern = "^res_ql_")])

# 分布が正によっている課題群
df_choice_res1 <- 
  choice_result_1 %>% 
  dplyr::bind_rows() %>% # 4つのリストを結合する
  dplyr::mutate(sim_n = rep(1:4, each = 1e5)) %>% 
  dplyr::mutate(
    sim_name = 
      case_when(
        sim_n == 1 ~ "N(20, 20) vs N(20, 5) (Gain domain)",
        sim_n == 2 ~ "N(10, 20) vs N(10, 5) (Gain domain)",
        sim_n == 3 ~ "N(-10, 20) vs N(-10, 5) (Loss domain)",
        sim_n == 4 ~ "N(-20, 20) vs N(-20, 5) (Loss domain)",
      )
  )

# factor型のlevelを指定して、facetした時の順序を指定
df_choice_res1$sim_name <- factor(df_choice_res1$sim_name, levels = c("N(20, 20) vs N(20, 5) (Gain domain)", "N(10, 20) vs N(10, 5) (Gain domain)", "N(-10, 20) vs N(-10, 5) (Loss domain)", "N(-20, 20) vs N(-20, 5) (Loss domain)"))

# 分布が0〜負によっている課題群
df_choice_res4 <- 
  choice_result_4 %>% 
  dplyr::bind_rows() %>% # 4つのリストを結合する
  dplyr::mutate(sim_n = rep(1:4, each = 1e5)) %>% 
  dplyr::mutate(
    sim_name = 
      case_when(
        sim_n == 1 ~ "N(20, 20) vs N(20, 5) (Gain domain)",
        sim_n == 2 ~ "N(10, 20) vs N(10, 5) (Gain domain)",
        sim_n == 3 ~ "N(-10, 20) vs N(-10, 5) (Loss domain)",
        sim_n == 4 ~ "N(-20, 20) vs N(-20, 5) (Loss domain)",
      )
  )

# factor型のlevelを指定して、facetした時の順序を指定
df_choice_res4$sim_name <- factor(df_choice_res4$sim_name, levels = c("N(20, 20) vs N(20, 5) (Gain domain)", "N(10, 20) vs N(10, 5) (Gain domain)", "N(-10, 20) vs N(-10, 5) (Loss domain)", "N(-20, 20) vs N(-20, 5) (Loss domain)"))

# 分布が負によっている課題群
df_choice_res7 <- 
  choice_result_7 %>% 
  dplyr::bind_rows() %>% # 4つのリストを結合する
  dplyr::mutate(sim_n = rep(1:4, each = 1e5)) %>% 
  dplyr::mutate(
    sim_name = 
      case_when(
        sim_n == 1 ~ "N(20, 20) vs N(20, 5) (Gain domain)",
        sim_n == 2 ~ "N(10, 20) vs N(10, 5) (Gain domain)",
        sim_n == 3 ~ "N(-10, 20) vs N(-10, 5) (Loss domain)",
        sim_n == 4 ~ "N(-20, 20) vs N(-20, 5) (Loss domain)",
      )
  )

# factor型のlevelを指定して、facetした時の順序を指定
df_choice_res7$sim_name <- factor(df_choice_res7$sim_name, levels = c("N(20, 20) vs N(20, 5) (Gain domain)", "N(10, 20) vs N(10, 5) (Gain domain)", "N(-10, 20) vs N(-10, 5) (Loss domain)", "N(-20, 20) vs N(-20, 5) (Loss domain)"))

```


# 1. Introduction

## Fig.1 Q値が漸近していく図

- alpha = 0.1とalpha = 0.6の2種類
- beta = 0.1
- N(20,5)とN(10,5)の2つの選択肢から選ぶ


```{r, eval=FALSE}
# シミュレーションを行う
params <- 
  tibble(
    alpha = c(0.1, 0.6),
    bt = c(0.1, 0.1)
  )

task_struct <- 
  c(20, 5, 10, 5)

trial_N <- 100

Res_RunQL_single <- 
  RunQL_single(params, task_struct, trial_N)

# R objectに保存
save(Res_RunQL_single, file = here("Data", "Other_Sim", "res_ql_single_Fig1.RData")
```

```{r, eval=FALSE}
load(file = here("Data", "Other_Sim", "res_ql_single_Fig1.RData"))
```

```{r, eval=FALSE}
# alpha = 0.1, beta = 0.1の個体
g1 <- Res_RunQL_single$Q[1,,] %>% 
  tibble::as_tibble() %>% 
  dplyr::rename(
    V1 = V1, 
    V2 = V2
    ) %>% 
  tibble::rownames_to_column(var = "trial") %>% 
  dplyr::mutate(trial = as.integer(trial)) %>% 
  tidyr::pivot_longer(cols = c(-trial), names_to = "V", values_to = "Vvalue") %>% 
  
  ggplot(aes(x = trial, y = Vvalue, color = V)) + 
  geom_line(size = 1.3) + 
  labs(x = "Trial", y = "V value", color = "V") + 
  my_theme2 + theme(axis.text.x = element_text(size = 18), axis.text.y = element_text(size = 15), axis.title=element_text(size = 18, face="bold"), legend.text = element_text(family = "serif"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(color = "transparent", fill = "white"), legend.position = c(1, 0.35), legend.justification = c(1, 1)) + 
  coord_cartesian(ylim = c(0, 25)) + 
  scale_color_manual(name = "", values = c("#FF7F00", "#1F78B4"), labels = c("V(1)", "V(2)")) + 
  ggsave(here(output_path, "Fig1_1_Simulate_value.png"), width = 5.0, height = 5.5)
  
g2 <- Res_RunQL_single$p[1,] %>% 
  tibble::as_tibble() %>% 
  tibble::rownames_to_column(var = "trial") %>% 
  dplyr::mutate(trial = as.integer(trial)) %>% 
  
  ggplot(aes(x = trial, y = value)) + 
  geom_line(size = 1.5) + 
  labs(x = "Trial", y = "P(action = 1)") + 
  my_theme2 + theme(axis.text.x = element_text(size = 18), axis.text.y = element_text(size = 15), axis.title=element_text(size = 18, face="bold")) + 
  coord_cartesian(ylim = c(0.0, 1.0)) +
  ggsave(here(output_path, "Fig1_1_Simulate_p.png"), width = 5.0, height = 5.5)
  
g_fig <- g1 + g2

ggsave(filename = here(output_path, "Fig1_Simulate_value_p.png"), plot = g_fig, width = 9.0, height = 5.0)
 

# alpha = 0.6, beta = 0.1の個体
# 途中
Res_RunQL_single$Q[2,,] %>% 
  as_tibble(rownames = "trial") %>% 
  dplyr::rename(
    V1 = V1, 
    V2 = V2
    ) %>% 
  dplyr::mutate(trial = as.integer(trial)) %>% 
  tidyr::pivot_longer(cols = c(-trial), names_to = "V", values_to = "Vvalue") %>% 
  
  ggplot(aes(x = trial, y = Vvalue, color = V)) + 
  geom_line(size = 1.3) + 
  labs(x = "Trial", y = "V value", color = "V") + 
  my_theme2 + theme(axis.text.x = element_text(size = 18), axis.text.y = element_text(size = 15), axis.title=element_text(size = 18, face="bold"), legend.text = element_text(family = "serif"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(color = "transparent", fill = "white"), legend.position = c(1, 0.35), legend.justification = c(1, 1)) + 
  coord_cartesian(ylim = c(0, 30)) + 
  scale_color_manual(name = "", values = c("#FF7F00", "#1F78B4"), labels = c("V(1)", "V(2)")) -> g

ggsave(plot = g, filename = here(output_path, "Fig1_2_Simulate_value.png"), width = 5.0, height = 5.5)
  
```


# 3. Results

## Fig.X シミュレーションで変化させた2つの要因

```{r}
# 以下、全てリスク回避が適応的な課題で見せる

g_posi_smallrisk <- TaskStrucFunc2(10, 10, 30, 5)

g_nega_smallrisk <- TaskStrucFunc2(-30, 10, -10, 5)

g_posi_largerisk <- TaskStrucFunc2(10, 30, 30, 5)

g_nega_largerisk <- TaskStrucFunc2(-30, 30, -10, 5)

g_Fig2 <- 
  g_nega_smallrisk + plot_spacer() + g_posi_smallrisk + 
  plot_spacer() + plot_spacer() + plot_spacer() +
  g_nega_largerisk + plot_spacer() + g_posi_largerisk + 
  plot_layout(ncol = 3, widths = c(4, 1, 4), heights = c(4, 1, 4))

ggsave(filename = here(output_path, "Fig2_TwoFactors_posi_smallrisk.png"), plot = g_posi_smallrisk, width = 6.0, height = 6.0)
ggsave(filename = here(output_path, "Fig2_TwoFactors_nega_smallrisk.png"), plot = g_nega_smallrisk, width = 6.0, height = 6.0)
ggsave(filename = here(output_path, "Fig2_TwoFactors_posi_largerisk.png"), plot = g_posi_largerisk, width = 6.0, height = 6.0)
ggsave(filename = here(output_path, "Fig2_TwoFactors_nega_largerisk.png"), plot = g_nega_largerisk, width = 6.0, height = 6.0)

#ggsave(filename = "./FiguresForPaper/Fig2_TwoFactors_simulation.png", plot = g_Fig2, width = 7.0, height = 5.5)
```


## Fig.1 単一：全シミュレーション リスク回避率


- 横軸: 課題の期待値、縦軸: 最終世代のリスク回避率の平均値(+SD)

```{r, eval = FALSE}
# リスク回避が適応的な課題
target_simexp <- c("-50 vs -30", "-40 vs -20", "-30 vs -10", "-20 vs 0", "-10 vs 10", "0 vs 20", "10 vs 30")

g <- VisFirstLastGene_RiskAversion(df_gene_riskaversion_mean, target_simexp, "Risk-aversion task")

ggsave(plot = g, filename = here(output_path, "Fig1.1_LastGene_RiskAversion_risk-aversion_inrow.png"), width = 20.0, height = 6.0)
```

 
```{r, eval = FALSE}
# リスク追求が適応的な課題
target_simexp <- c("-10 vs -30", "0 vs -20", "10 vs -10", "20 vs 0", "30 vs 10", "40 vs 20", "50 vs 30")

g <- VisFirstLastGene_RiskAversion(df_gene_riskaversion_mean, target_simexp, "Risk-seeking task")

ggsave(plot = g, filename = here(output_path, "Fig1.2_LastGene_RiskAversion_risk-seeking_inrow.png"), width = 20.0, height = 6.0)
```


## Fig.2 単一：6つの典型的な結果 進化

- 横軸: 世代、縦軸: 遺伝子の値

```{r, eval = FALSE}
# リスク回避が適応的な課題

target_sim <- c("20.5.0.20", "0.5.-20.20", "-20.5.-40.20")

g <- VisEvol_Para_RunMean_facetSim(df_gene_longer, target_sim, "alpha", "Risk-aversion task")

ggsave(plot = g, filename = here(output_path, "Fig2.1_Evo_apan_risk-aversion_6.png"), width = 15.0, height = 6.0)
```


```{r, eval = FALSE}
# リスク追求が適応的な課題

target_sim <- c("20.5.40.20", "0.5.20.20", "-20.5.0.20")

g <- VisEvol_Para_RunMean_facetSim(df_gene_longer, target_sim, "alpha", "Risk-seeking task", legend = FALSE)

ggsave(plot = g, filename = here(output_path, "Fig2.2_Evo_apan_risk-seeking_6.png"), width = 15.0, height = 6.0)
```


## Fig.3 単一：全シミュレーション 進化

- 横軸: 課題の期待値、縦軸: 最終世代の遺伝子の平均値（+SD）


```{r, eval = FALSE}
# リスク回避が適応的な課題
target_simexp <- c("-50 vs -30", "-40 vs -20", "-30 vs -10", "-20 vs 0", "-10 vs 10", "0 vs 20", "10 vs 30")

g <- VisLastGene_Para_RunMean(df_gene_longer, target_simexp, "alpha", "Risk-aversion task")

ggsave(plot = g, filename = here(output_path, "Fig3.1_LastGene_apan_risk-aversion_inrow.png"), width = 20.0, height = 6.0)
```


```{r, eval = FALSE}
# リスク追求が適応的な課題
target_simexp <- c("-10 vs -30", "0 vs -20", "10 vs -10", "20 vs 0", "30 vs 10", "40 vs 20", "50 vs 30")

g <- VisLastGene_Para_RunMean(df_gene_longer, target_simexp, "alpha", "Risk-seeking task", legend = FALSE)

ggsave(plot = g, filename = here(output_path, "Fig3.2_LastGene_apan_risk-seeking_inrow.png"), width = 20.0, height = 6.0)
```



## Fig.4-1 ランダム複数：進化の結果

  
- 横軸: 世代、縦軸: 遺伝子の値（細い線は1つのシミュレーション）


```{r, eval = FALSE} 
df_gene_randmulti_summary_longer %>% 
  dplyr::filter(para %in% c("ap", "an")) %>% 
  dplyr::mutate(
    cond_rev = case_when(
      sim == "cond_0/4" ~ "risk seeking/aversion = 0/4",
      sim == "cond_1/3" ~ "risk seeking/aversion = 1/3",
      sim == "cond_2/2" ~ "risk seeking/aversion = 2/2",
      sim == "cond_3/1" ~ "risk seeking/aversion = 3/1",
      sim == "cond_4/0" ~ "risk seeking/aversion = 4/0"
    ),
    para_rev = case_when(
      para == "ap" ~ "alpha[p]",
      para == "an" ~ "alpha[n]"
    )
  ) -> 
  df_gene_randmulti_summary_longer_rev

df_gene_randmulti_longer %>% 
  dplyr::filter(para %in% c("ap", "an")) %>% 
  dplyr::mutate(
    cond_rev = case_when(
      sim == "cond_0/4" ~ "risk seeking/aversion = 0/4",
      sim == "cond_1/3" ~ "risk seeking/aversion = 1/3",
      sim == "cond_2/2" ~ "risk seeking/aversion = 2/2",
      sim == "cond_3/1" ~ "risk seeking/aversion = 3/1",
      sim == "cond_4/0" ~ "risk seeking/aversion = 4/0"
    ),
    para_rev = case_when(
      para == "ap" ~ "alpha[p]",
      para == "an" ~ "alpha[n]"
    )
  ) %>% 
  
  ggplot(aes(x = generation, y = mean)) + geom_line(aes(group = sim_i), size = 0.08) + 
  geom_line(data = df_gene_randmulti_summary_longer_rev, aes(x = generation, y = MEAN, color = para), size = 2.0) +
  my_theme2 + labs(x = 'Generation', y = 'Parameter') + guides(color = "none") + 
  scale_color_manual(name = "", values = c("#1F78B4", "#FF7F00"), 
                     labels = c(expression(paste(alpha[n])), expression(paste(alpha[p])))) +  
  theme(
    axis.text.x = element_text(size = 18), 
    axis.text.y = element_text(size = 15), 
    strip.text.x = element_text(size = 15),
    strip.text.y = element_text(angle = 0)
  ) + 
  facet_grid(para_rev~cond_rev, 
             labeller = labeller(para_rev = label_parsed)) + 
  coord_cartesian(ylim = c(0, 1.0)) ->
  g
  
ggsave(plot = g, filename = here(output_path, "Fig4_Evo_RandMulti_apan.png"), width = 19.0, height = 7.0)
```


## Fig 4-2 ランダム複数：$\alpha_p$は負の領域の大きさで説明される


```{r}
df_gene_randmulti_taskinfo_longer %>% 
  dplyr::filter(para %in% c("ap")) %>% 
  dplyr::mutate(
    cond_rev = case_when(
      sim == "cond_0/4" ~ "risk seeking/aversion = 0/4",
      sim == "cond_1/3" ~ "risk seeking/aversion = 1/3",
      sim == "cond_2/2" ~ "risk seeking/aversion = 2/2",
      sim == "cond_3/1" ~ "risk seeking/aversion = 3/1",
      sim == "cond_4/0" ~ "risk seeking/aversion = 4/0"
    )
  ) %>% 
  
  ggplot(aes(x = mean_area_rate, y = mean)) + geom_point() + geom_smooth(method = "lm") + 
  my_theme2 + facet_grid(.~cond_rev) + 
  theme(
    axis.text.x = element_text(size = 18), 
    axis.text.y = element_text(size = 15), 
    strip.text.x = element_text(size = 15)
  ) + 
  labs(x = "mean negative area rate", y = "parameter at the last generation") -> g

ggsave(plot = g, filename = here(output_path, "Fig4.2_Relation_RandMulti_ap_NegaArea.png"), width = 17.0, height = 6.0)
```


## Fig.5 ランダム複数：4課題のリスク回避率

- （とりあえず）2/2課題を取り出す
- 横軸：負の領域の大きさ、縦軸：リスク回避率の平均値

- リスク回避課題とリスク追求課題で分けない


```{r, eval=FALSE, fig.width=20, fig.height=8}
df_agent_randmulti_simMEAN %>% 
  
  dplyr::mutate(
    generation = generation + 1,
    task_type_rev = if_else(task_type == "risk_aversion", "risk aversion", "risk seeking")
    ) %>% 
  
  ggplot(aes(x = as.factor(generation), y = MEAN_risk_aversion, color = task_type_rev, group = task_type_rev)) + 
  geom_linerange(aes(ymin = MEAN_risk_aversion - SD_risk_aversion, ymax = MEAN_risk_aversion + SD_risk_aversion), size = 1.5, position = position_dodge(width = 0.5)) + 
  geom_point(size = 3.0, stroke = 1.5, shape = 21, fill = "white", position = position_dodge(width = 0.5)) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15, angle = 35, hjust = 1),
        axis.text.y = element_text(size = 15),
        axis.title = element_text(size = 14, face = "bold"),
        strip.text.x = element_text(size = 15)) + 
  scale_color_manual(values=c("#1F78B4", "#FF7F00")) + 
  coord_cartesian(ylim = c(0, 1)) + 
  labs(x = "Generation",
       y = "Rate of risk aversion",
       color = "task") + 
  guides(fill = 'none') + 
  facet_wrap(~sim_n, ncol = 5) -> g
  
ggsave(plot = g, filename = here(output_path, "Fig5_LastGene_RiskAversion_RandMulti.png"), width = 20.0, height = 5.0)
```


```{r}
# パフォーマンスの改善を計算する
df_agent_randmulti_summary %>%
  tidyr::pivot_wider(id_cols = c(sim_i, task_i, task_number, task_type), names_from = generation, values_from = mean_risk_aversion, names_prefix = "gene_") %>% 
  dplyr::mutate(improve = case_when(
    (task_type == "risk_seeking") & (gene_0 > gene_2999) ~ 1,
    (task_type == "risk_seeking") & (gene_0 <= gene_2999) ~ 0,
    (task_type == "risk_aversion") & (gene_0 < gene_2999) ~ 1,
    (task_type == "risk_aversion") & (gene_0 >= gene_2999) ~ 0,
  )) %>% 
  dplyr::group_by(task_type) %>% 
  dplyr::summarise(
    count = sum(improve),
    rate = count/n()
  )
```


```{r}
# 最終世代で、リスク回避で0.9以上、リスク追求で0.1以下になった課題数を数える

df_agent_randmulti_summary %>%
  dplyr::filter(generation == 2999) %>% 
  dplyr::mutate(achieve = case_when(
    (task_type == "risk_seeking") & (mean_risk_aversion < 0.1) ~ 1,
    (task_type == "risk_seeking") & (mean_risk_aversion >= 0.1) ~ 0,
    (task_type == "risk_aversion") & (mean_risk_aversion > 0.9) ~ 1,
    (task_type == "risk_aversion") & (mean_risk_aversion <= 0.9) ~ 0,
  )) %>% 
  dplyr::group_by(task_type) %>% 
  dplyr::summarise(
    count = sum(achieve),
    rate = count/n()
  )
```


## Fig.6 ランダム複数：simごとの試行を通しての学習ダイナミクスを図示

- 横軸: 試行、縦軸: リスク回避率
- パネル：課題 * 世代


```{r, eval=FALSE}
# RandomMulti_trialのディレクトリ作成
#dir.create(here(output_path, "RandomMulti_trial"))

sim_j_vec <- 1:Extract_SimN

purrr::walk(sim_j_vec, ~VisTrial_RandMulti_RiskAversion_facetTask_bySim(df_trial_randmulti, df_trial_randmulti_summary, .x, output_path))
```


```{r}
# simごとの平均値を算出する、


```


## Fig.9 複数：エージェントの学習ダイナミクス

- 横軸: 試行、縦軸: リスク回避率
- パネル：課題 * 世代


```{r}
g <- VisTrial_Multi_RiskAversion_facetTask(df_trialP22_meanSD, "Positively located simulation")

ggsave(plot = g, filename = here(output_path, "Fig9.1_Trial_RiskAversion_MultiTask_Positive.png"), width = 18.0, height = 10.0)
```

```{r}
g <- VisTrial_Multi_RiskAversion_facetTask(df_trialN22_meanSD, "Negatively located simulation")

ggsave(plot = g, filename = here(output_path, "Fig9.2_Trial_RiskAversion_MultiTask_Negative.png"), width = 18.0, height = 10.0)
```



## Fig.10 apとanの組合せと平均リスク回避率


```{r}
# リスク回避が適応的な課題
## リスク選択肢のリスク = 20の課題だけ取り出す
target_sim <- as.factor(c(
 "30.5.10.20", "20.5.0.20", "10.5.-10.20", "0.5.-20.20", "-10.5.-30.20", "-20.5.-40.20", "-30.5.-50.20"
))

g <- VisHeatmap_RiskAversion(df_withingene, target_sim, "Risk-aversion task")

ggsave(plot = g, filename = here(output_path, "Fig10.1_Heatmap_RiskAversion_risk-aversion.png"), width = 17.0, height = 4.5)
```


```{r}
# リスク追求が適応的な課題
## リスク選択肢のリスク = 20の課題だけ取り出す
target_sim <- factor(c(
  "30.5.50.20", "20.5.40.20", "10.5.30.20", "0.5.20.20", "-10.5.10.20", "-20.5.0.20", "-30.5.-10.20"
))

g <- VisHeatmap_RiskAversion(df_withingene, target_sim, "Risk-seeking task")

ggsave(plot = g, filename = here(output_path, "Fig10.2_Heatmap_RiskAversion_risk-seeking.png"), width = 17.0, height = 4.5)
```


```{r}
# リスク追求が適応的な課題
## リスク選択肢のリスク = 20の課題だけ取り出す
sim_name <- factor(c(
  "30.5.50.20", "20.5.40.20", "10.5.30.20", "0.5.20.20", "-10.5.10.20", "-20.5.0.20", "-30.5.-10.20"
))
  
df_withingene %>%
  dplyr::filter(sim %in% sim_name) %>% 
  dplyr::mutate(
    ap = round(ap, 4),
    an = round(an, 4),
    bt = round(bt, 4),
    rate_risk_aversion = 1 - choice_rate1,
    sim_fac = factor(sim, levels = sim_name) %>% as.numeric()
  ) %>% 
  dplyr::mutate(
    sim_sort = factor(paste0('N(', m2, ',', sd2, ') vs N(', m1, ',', sd1, ')')) %>% forcats::fct_reorder(., sim_fac, .desc = TRUE)
  ) %>% 
  dplyr::group_by(sim_sort, ap, an, bt) %>%
  dplyr::summarise(
    mean_pvalue = mean(average_pvalue), 
    sd_pvalue = sqrt(variance(average_pvalue)),
    mean_risk_aversion = mean(rate_risk_aversion),
    sd_risk_aversion = sqrt(variance(rate_risk_aversion))
  ) %>%
  dplyr::filter(bt == 0.25) %>% 
  
  ggplot(aes(x = ap, y = an)) + 
  geom_raster(aes(fill = mean_risk_aversion)) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 11, angle = 30, hjust = 1), axis.text.y = element_text(size = 14), axis.title=element_text(size=14, face="bold"), strip.text.x = element_text(size = 10),
        legend.text = element_text(size = 9), legend.title= element_text(size = 10),
        panel.grid = element_blank()) + 
  scale_fill_gradient2(midpoint=0.5, low="#FF7F00", mid="white", high="#1F78B4", limits = c(0, 1)) + 
  facet_grid(.~sim_sort) + 
  labs(x = expression(alpha[p]), y = expression(alpha[n]), fill = "risk aversion",
       subtitle = "Risk-seeking task") -> g

ggsave(plot = g, filename = here(output_path, "Fig10_2_ra_heatmap_risk_seeking.png"), width = 17.0, height = 4.5)

```


## Fig.11 期待値が同じ課題でのリスク回避率

- 横軸: リスク回避率、縦軸: 頻度


```{r, eval = FALSE}
df_choice_res1 %>% 
  ggplot(aes(x = risk_aversion)) + 
  geom_histogram() + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15)) + 
  facet_grid(.~sim_name) + 
  labs(x = "Rate of risk aversion", y = "Frequency of agent", subtitle = 'Evolved in positively located simulation, risk aversion/risk seeking = 2/2') -> g

ggsave(plot = g, filename = here(output_path, "Fig11_1_RiskPref_MultiTask1.0.png"), width = 18.0, height = 6.0)
```


```{r, eval = FALSE}
df_choice_res4 %>% 
  ggplot(aes(x = risk_aversion)) + 
  geom_histogram() + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15)) + 
  facet_grid(.~sim_name) + 
  labs(x = "Rate of risk aversion", y = "Frequency of agent", subtitle = 'Evolved in centrally located simulation, risk aversion/risk seeking = 2/2') -> g

ggsave(plot = g, filename = here(output_path, "Fig11_2_RiskPref_MultiTask4.0.png"), width = 18.0, height = 6.0)
```


```{r, eval = FALSE}
df_choice_res7 %>% 
  ggplot(aes(x = risk_aversion)) + 
  geom_histogram() + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15)) + 
  facet_grid(.~sim_name) + 
  labs(x = "Rate of risk aversion", y = "Frequency of agent", subtitle = 'Evolved in negatively located simulation, risk aversion/risk seeking = 2/2') -> g

ggsave(plot = g, filename = here(output_path, "Fig11_3_RiskPref_MultiTask7.0.png"), width = 18.0, height = 6.0)
```

### 分布の代表値を求める

```{r}
# Gain domainにおける2つのモード
a <- df_choice_res1 %>% 
  dplyr::filter(risk_aversion == 0.0 | risk_aversion == 1.0) %>% 
  dplyr::group_by(sim_name, risk_aversion) %>% 
  dplyr::summarise(
    N = n(),
    rate = N/100000
  ) %>% 
  dplyr::mutate(
    loc = "positive"
  )

b <- df_choice_res4 %>% 
  dplyr::filter(risk_aversion == 0.0 | risk_aversion == 1.0) %>% 
  dplyr::group_by(sim_name, risk_aversion) %>% 
  dplyr::summarise(
    N = n(),
    rate = N/100000
  ) %>% 
  dplyr::mutate(
    loc = "center"
  )

c <- df_choice_res7 %>% 
  dplyr::filter(risk_aversion == 0.0 | risk_aversion == 1.0) %>% 
  dplyr::group_by(sim_name, risk_aversion) %>% 
  dplyr::summarise(
    N = n(),
    rate = N/100000
  ) %>% 
  dplyr::mutate(
    loc = "negative"
  )

# 各課題でのモード
a %>% 
  dplyr::bind_rows(b, c) %>% 
  dplyr::filter(stringr::str_detect(string = sim_name, pattern = "Gain")) %>% 
  dplyr::group_by(loc, sim_name, risk_aversion) %>% 
  dplyr::summarise(
    mean_rate = mean(rate)
  )

# 全平均
a %>% 
  dplyr::bind_rows(b, c) %>% 
  dplyr::filter(stringr::str_detect(string = sim_name, pattern = "Gain")) %>% 
  dplyr::group_by(risk_aversion) %>% 
  dplyr::summarise(
    mean_rate = mean(rate)
  )
  

# Loss domainにおけるモード
map_value <- function(z) {
  
  val <- density(z)$x[which.max(density(z)$y)]
  return(val)
  
}

df_choice_res1_sim3 <- 
  df_choice_res1 %>% 
  dplyr::filter(stringr::str_detect(string = sim_name, pattern = "Loss")) %>% 
  dplyr::filter(sim_n == 3)

mvalue_3 <- map_value(df_choice_res1_sim3$risk_aversion)

df_choice_res1_sim4 <- 
  df_choice_res1 %>% 
  dplyr::filter(stringr::str_detect(string = sim_name, pattern = "Loss")) %>% 
  dplyr::filter(sim_n == 4)

mvalue_4 <- map_value(df_choice_res1_sim4$risk_aversion)
```


### Risk aversion rate 90%以上、10%以下の頻度%をそれぞれ求める

```{r}
# 正に偏っている：Positively-located
df_choice_res1 %>% 
  dplyr::mutate(
    risk_aversion_categ = 
      case_when(
        risk_aversion >= 0.90 ~ "high",
        (risk_aversion < 0.90) & (risk_aversion > 0.10) ~ "med",
        risk_aversion <= 0.10 ~ "low"
      )
  ) %>% 
  dplyr::group_by(sim_name, risk_aversion_categ) %>% 
  dplyr::summarise(
    frequency = n(),
    rate = frequency/100000
  )

# 中央：Centrally-located
df_choice_res4 %>% 
  dplyr::mutate(
    risk_aversion_categ = 
      case_when(
        risk_aversion >= 0.90 ~ "high",
        (risk_aversion < 0.90) & (risk_aversion > 0.10) ~ "med",
        risk_aversion <= 0.10 ~ "low"
      )
  ) %>% 
  dplyr::group_by(sim_name, risk_aversion_categ) %>% 
  dplyr::summarise(
    frequency = n(),
    rate = frequency/100000
  )

# 負に偏っている：Negatively-located
df_choice_res7 %>% 
  dplyr::mutate(
    risk_aversion_categ = 
      case_when(
        risk_aversion >= 0.90 ~ "high",
        (risk_aversion < 0.90) & (risk_aversion > 0.10) ~ "med",
        risk_aversion <= 0.10 ~ "low"
      )
  ) %>% 
  dplyr::group_by(sim_name, risk_aversion_categ) %>% 
  dplyr::summarise(
    frequency = n(),
    rate = frequency/100000
  )
  
```


### Risk aversion rate の平均値をそれぞれのグラフについて求める


```{r}
# 正に偏っている：Positively-located
df_choice_res1 %>% 
  dplyr::group_by(sim_n, sim_name) %>% 
  dplyr::summarise(
    mean = mean(risk_aversion)
  )

# 中央にいる：Centrally-located  
df_choice_res4 %>% 
  dplyr::group_by(sim_n, sim_name) %>% 
  dplyr::summarise(
    mean = mean(risk_aversion)
  )

# 負に偏っている：Negatively-located
df_choice_res7 %>% 
  dplyr::group_by(sim_n, sim_name) %>% 
  dplyr::summarise(
    mean = mean(risk_aversion)
  )
  
```


### Risk aversion rateについて、プロスペクト理論的な振る舞いのエージェントを取り出す

- Gain → Lossでリスク回避率が減少した個体の割合を算出
- 僅かでもリスク回避率が減少していたら、「（相対的な）プロスペクト理論的な個体」とみなす

```{r}
# task 1 → 3で減少
# task 1 → 4で減少
# task 2 → 3で減少
# task 2 → 4で減少

# 正に偏っている：Positively-located

df_choice_res1 %>% 
  dplyr::mutate(
    sim_n = paste0("aversion_", sim_n)
  ) %>% 
  tidyr::pivot_wider(id_cols = "agent", names_from = sim_n, values_from = risk_aversion) %>% 
  dplyr::mutate(
    switch1_3 = if_else(aversion_1 > aversion_3, 1, 0),
    switch1_4 = if_else(aversion_1 > aversion_4, 1, 0),
    switch2_3 = if_else(aversion_2 > aversion_3, 1, 0),
    switch2_4 = if_else(aversion_2 > aversion_4, 1, 0)
  ) %>% 
  tidyr::pivot_longer(cols = c(switch1_3, switch1_4, switch2_3, switch2_4), names_to = "switch", values_to = "frequency") %>% 
  dplyr::group_by(switch) %>% 
  dplyr::summarise(
    count = sum(frequency),
    rate = count/100000
  )

# 中央にある：Centrally-located

df_choice_res4 %>% 
  dplyr::mutate(
    sim_n = paste0("aversion_", sim_n)
  ) %>% 
  tidyr::pivot_wider(id_cols = "agent", names_from = sim_n, values_from = risk_aversion) %>% 
  dplyr::mutate(
    switch1_3 = if_else(aversion_1 > aversion_3, 1, 0),
    switch1_4 = if_else(aversion_1 > aversion_4, 1, 0),
    switch2_3 = if_else(aversion_2 > aversion_3, 1, 0),
    switch2_4 = if_else(aversion_2 > aversion_4, 1, 0)
  ) %>% 
  tidyr::pivot_longer(cols = c(switch1_3, switch1_4, switch2_3, switch2_4), names_to = "switch", values_to = "frequency") %>% 
  dplyr::group_by(switch) %>% 
  dplyr::summarise(
    count = sum(frequency),
    rate = count/100000
  )

# 負にある：Negatively-located

df_choice_res7 %>% 
  dplyr::mutate(
    sim_n = paste0("aversion_", sim_n)
  ) %>% 
  tidyr::pivot_wider(id_cols = "agent", names_from = sim_n, values_from = risk_aversion) %>% 
  dplyr::mutate(
    switch1_3 = if_else(aversion_1 > aversion_3, 1, 0),
    switch1_4 = if_else(aversion_1 > aversion_4, 1, 0),
    switch2_3 = if_else(aversion_2 > aversion_3, 1, 0),
    switch2_4 = if_else(aversion_2 > aversion_4, 1, 0)
  ) %>% 
  tidyr::pivot_longer(cols = c(switch1_3, switch1_4, switch2_3, switch2_4), names_to = "switch", values_to = "frequency") %>% 
  dplyr::group_by(switch) %>% 
  dplyr::summarise(
    count = sum(frequency),
    rate = count/100000
  )
```

- リスク回避率50%以上の個体をリスク回避的な個体、50%未満をリスク追求的な個体とした場合の変化の割合

```{r}
# 正に偏っている：Positively-located

df_choice_res1 %>% 
  dplyr::mutate(
    sim_n = paste0("aversion_", sim_n),
    agenttype = if_else(risk_aversion > 0.5, 1, 0) # 1: risk-averse agent, 0: risk-seeking agent
    ) %>% 
  tidyr::pivot_wider(id_cols = "agent", names_from = sim_n, values_from = agenttype) %>% 
  dplyr::mutate(
    switch_1_3 = case_when(
      aversion_1 > aversion_3 ~ "decrease",
      aversion_1 == aversion_3 ~ "same",
      aversion_1 < aversion_3 ~ "increase"
    ), 
    switch_1_4 = case_when(
      aversion_1 > aversion_4 ~ "decrease",
      aversion_1 == aversion_4 ~ "same",
      aversion_1 < aversion_4 ~ "increase"
    ),
    switch_2_3 = case_when(
      aversion_2 > aversion_3 ~ "decrease",
      aversion_2 == aversion_3 ~ "same",
      aversion_2 < aversion_3 ~ "increase"
    ),
    switch_2_4 = case_when(
      aversion_2 > aversion_4 ~ "decrease",
      aversion_2 == aversion_4 ~ "same",
      aversion_2 < aversion_4 ~ "increase"
    )
  ) %>% 
  tidyr::pivot_longer(cols = c(-agent, -aversion_1, -aversion_2, -aversion_3, -aversion_4), names_to = "switch", values_to = "switch_type") %>% 
  dplyr::group_by(switch, switch_type) %>% 
  dplyr::summarise(
    count = n(),
    rate = count/100000
  ) %>% 
  readr::write_csv(file = here(output_path, "RiskPref_MultiTask1.0_switch_type.csv"))

# 中央にある：Centrally-located

df_choice_res4 %>% 
  dplyr::mutate(
    sim_n = paste0("aversion_", sim_n),
    agenttype = if_else(risk_aversion > 0.5, 1, 0) # 1: risk-averse agent, 0: risk-seeking agent
    ) %>% 
  tidyr::pivot_wider(id_cols = "agent", names_from = sim_n, values_from = agenttype) %>% 
  dplyr::mutate(
    switch_1_3 = case_when(
      aversion_1 > aversion_3 ~ "decrease",
      aversion_1 == aversion_3 ~ "same",
      aversion_1 < aversion_3 ~ "increase"
    ), 
    switch_1_4 = case_when(
      aversion_1 > aversion_4 ~ "decrease",
      aversion_1 == aversion_4 ~ "same",
      aversion_1 < aversion_4 ~ "increase"
    ),
    switch_2_3 = case_when(
      aversion_2 > aversion_3 ~ "decrease",
      aversion_2 == aversion_3 ~ "same",
      aversion_2 < aversion_3 ~ "increase"
    ),
    switch_2_4 = case_when(
      aversion_2 > aversion_4 ~ "decrease",
      aversion_2 == aversion_4 ~ "same",
      aversion_2 < aversion_4 ~ "increase"
    )
  ) %>% 
  tidyr::pivot_longer(cols = c(-agent, -aversion_1, -aversion_2, -aversion_3, -aversion_4), names_to = "switch", values_to = "switch_type") %>% 
  dplyr::group_by(switch, switch_type) %>% 
  dplyr::summarise(
    count = n(),
    rate = count/100000
  ) %>% 
  readr::write_csv(file = here(output_path, "RiskPref_MultiTask4.0_switch_type.csv"))

# 負に偏っている：Negatively-located

df_choice_res7 %>% 
  dplyr::mutate(
    sim_n = paste0("aversion_", sim_n),
    agenttype = if_else(risk_aversion > 0.5, 1, 0) # 1: risk-averse agent, 0: risk-seeking agent
    ) %>% 
  tidyr::pivot_wider(id_cols = "agent", names_from = sim_n, values_from = agenttype) %>% 
  dplyr::mutate(
    switch_1_3 = case_when(
      aversion_1 > aversion_3 ~ "decrease",
      aversion_1 == aversion_3 ~ "same",
      aversion_1 < aversion_3 ~ "increase"
    ), 
    switch_1_4 = case_when(
      aversion_1 > aversion_4 ~ "decrease",
      aversion_1 == aversion_4 ~ "same",
      aversion_1 < aversion_4 ~ "increase"
    ),
    switch_2_3 = case_when(
      aversion_2 > aversion_3 ~ "decrease",
      aversion_2 == aversion_3 ~ "same",
      aversion_2 < aversion_3 ~ "increase"
    ),
    switch_2_4 = case_when(
      aversion_2 > aversion_4 ~ "decrease",
      aversion_2 == aversion_4 ~ "same",
      aversion_2 < aversion_4 ~ "increase"
    )
  ) %>% 
  tidyr::pivot_longer(cols = c(-agent, -aversion_1, -aversion_2, -aversion_3, -aversion_4), names_to = "switch", values_to = "switch_type") %>% 
  dplyr::group_by(switch, switch_type) %>% 
  dplyr::summarise(
    count = n(),
    rate = count/100000
  ) %>% 
  readr::write_csv(file = here(output_path, "RiskPref_MultiTask7.0_switch_type.csv"))
```


## Fig.12 Gain-Lossの差

### 2つのGain課題、2つのLoss課題で、それぞれの課題の平均値を計算する

```{r}
df_choice_res1 %>% 
  dplyr::mutate(gain_loss = if_else(sim_n == 1 | sim_n == 2, "gain", "loss")) %>% 
  dplyr::group_by(agent, ap, an, bt, an_ap, gain_loss) %>% 
  dplyr::summarise(
    mean_risk_aversion = mean(risk_aversion)
  ) %>% 
  dplyr::ungroup() %>% 
  tidyr::pivot_wider(id_cols = c(agent, ap, an, bt, an_ap), names_from = gain_loss, values_from = mean_risk_aversion) %>% 
  dplyr::mutate(
    risk_aver_gain_loss = gain - loss
  ) %>% 
  
  ggplot(aes(x = risk_aver_gain_loss)) + geom_histogram() + 
  geom_vline(xintercept = 0, color = "black") + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15)) +
  labs(x = "Gain - loss differece in the rate of risk aversion", y = "Frequency of agent", subtitle = 'Evolved in positively located simulation, risk aversion/risk seeking = 2/2') -> g

ggsave(plot = g, filename = here(output_path, "Fig12_1_RiskPrefDif_MultiTask1.0.png"), width = 13.0, height = 8.0)
```


```{r}
df_choice_res4 %>% 
  dplyr::mutate(gain_loss = if_else(sim_n == 1 | sim_n == 2, "gain", "loss")) %>% 
  dplyr::group_by(agent, ap, an, bt, an_ap, gain_loss) %>% 
  dplyr::summarise(
    mean_risk_aversion = mean(risk_aversion)
  ) %>% 
  dplyr::ungroup() %>% 
  tidyr::pivot_wider(id_cols = c(agent, ap, an, bt, an_ap), names_from = gain_loss, values_from = mean_risk_aversion) %>% 
  dplyr::mutate(
    risk_aver_gain_loss = gain - loss
  ) %>% 
  
  ggplot(aes(x = risk_aver_gain_loss)) + geom_histogram() + 
  geom_vline(xintercept = 0, color = "black") + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15)) +
  labs(x = "Gain - loss differece in the rate of risk aversion", y = "Frequency of agent", subtitle = 'Evolved in centrally located simulation, risk aversion/risk seeking = 2/2') -> g

ggsave(plot = g, filename = here(output_path, "Fig12_2_RiskPrefDif_MultiTask4.0.png"), width = 13.0, height = 8.0)
```


```{r}
df_choice_res7 %>% 
  dplyr::mutate(gain_loss = if_else(sim_n == 1 | sim_n == 2, "gain", "loss")) %>% 
  dplyr::group_by(agent, ap, an, bt, an_ap, gain_loss) %>% 
  dplyr::summarise(
    mean_risk_aversion = mean(risk_aversion)
  ) %>% 
  dplyr::ungroup() %>% 
  tidyr::pivot_wider(id_cols = c(agent, ap, an, bt, an_ap), names_from = gain_loss, values_from = mean_risk_aversion) %>% 
  dplyr::mutate(
    risk_aver_gain_loss = gain - loss
  ) %>% 
  
  ggplot(aes(x = risk_aver_gain_loss)) + geom_histogram() + 
  geom_vline(xintercept = 0, color = "black") + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15)) +
  labs(x = "Gain - loss differece in the rate of risk aversion", y = "Frequency of agent", subtitle = 'Evolved in negatively located simulation, risk aversion/risk seeking = 2/2') -> g

ggsave(plot = g, filename = here(output_path, "Fig12_3_RiskPrefDif_MultiTask7.0.png"), width = 13.0, height = 8.0)
```

### Gain-Loss: 統計値

```{r}
# 分布のピーク
df_choice_res1 %>% 
  dplyr::mutate(gain_loss = if_else(sim_n == 1 | sim_n == 2, "gain", "loss")) %>% 
  dplyr::group_by(agent, ap, an, bt, an_ap, gain_loss) %>% 
  dplyr::summarise(
    mean_risk_aversion = mean(risk_aversion)
  ) %>% 
  dplyr::ungroup() %>% 
  tidyr::pivot_wider(id_cols = c(agent, ap, an, bt, an_ap), names_from = gain_loss, values_from = mean_risk_aversion) %>% 
  dplyr::mutate(
    risk_aver_gain_loss = gain - loss
  ) -> x

x %>% dplyr::pull(risk_aver_gain_loss) -> vec_gain_loss
map_value(vec_gain_loss)

df_choice_res4 %>% 
  dplyr::mutate(gain_loss = if_else(sim_n == 1 | sim_n == 2, "gain", "loss")) %>% 
  dplyr::group_by(agent, ap, an, bt, an_ap, gain_loss) %>% 
  dplyr::summarise(
    mean_risk_aversion = mean(risk_aversion)
  ) %>% 
  dplyr::ungroup() %>% 
  tidyr::pivot_wider(id_cols = c(agent, ap, an, bt, an_ap), names_from = gain_loss, values_from = mean_risk_aversion) %>% 
  dplyr::mutate(
    risk_aver_gain_loss = gain - loss
  ) -> x

x %>% dplyr::pull(risk_aver_gain_loss) -> vec_gain_loss
map_value(vec_gain_loss)

df_choice_res7 %>% 
  dplyr::mutate(gain_loss = if_else(sim_n == 1 | sim_n == 2, "gain", "loss")) %>% 
  dplyr::group_by(agent, ap, an, bt, an_ap, gain_loss) %>% 
  dplyr::summarise(
    mean_risk_aversion = mean(risk_aversion)
  ) %>% 
  dplyr::ungroup() %>% 
  tidyr::pivot_wider(id_cols = c(agent, ap, an, bt, an_ap), names_from = gain_loss, values_from = mean_risk_aversion) %>% 
  dplyr::mutate(
    risk_aver_gain_loss = gain - loss
  ) -> x

x %>% dplyr::pull(risk_aver_gain_loss) -> vec_gain_loss
map_value(vec_gain_loss)
```

## Fig.13 単一$\beta$：全シミュレーション 進化


- 横軸: 課題の期待値、縦軸: 最終世代の遺伝子の平均値（+SD）


```{r, eval = FALSE}
# リスク回避が適応的な課題
target_sim <- c("-50 vs -30", "-40 vs -20", "-30 vs -10", "-20 vs 0", "-10 vs 10", "0 vs 20", "10 vs 30")

df_gene_longer %>% 
  dplyr::filter(generation == 4999) %>% # 最終世代のみ取り出す
  dplyr::filter(task_exp %in% target_sim) %>% 
  dplyr::mutate(task_sd = paste0("Risk of Risky Option = ", sd1)) %>% 
  dplyr::filter(para == "bt") %>% 
  
  ggplot(aes(x = task_exp, y = mean_rate, color = para, group = para)) + 
  geom_linerange(aes(ymin = mean_rate - sd_rate, ymax = mean_rate + sd_rate), size = 1.4, position = position_dodge(width = 0.5)) + 
  geom_line(position = position_dodge(width=0.7), size = 1.2, linetype = "twodash") + 
  geom_point(size = 2.5, position = position_dodge(width=0.5), stroke = 2, shape = 21, fill = "white") + 
  scale_color_manual(name = "", values = c("#33A02C"), labels = expression(beta)) +
  scale_fill_manual(values = c("#33A02C")) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 11, angle = 30, hjust = 1), axis.text.y = element_text(size = 15), axis.title=element_text(size=14, face="bold"), strip.text.x = element_text(size = 15), legend.text = element_text(family = "serif", face = "italic"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(fill = "white"), legend.position = c(1, 0.4), legend.justification = c(1, 1)) + 
  coord_cartesian(ylim = c(0, 0.5)) + 
  scale_x_discrete(limits = c("-50 vs -30", "-40 vs -20", "-30 vs -10", "-20 vs 0", "-10 vs 10", "0 vs 20", "10 vs 30")) + 
  facet_grid(.~task_sd) + 
  labs(x = "Location of two distributions (risky vs sure)", y = "Parameter value in the last generation",
       subtitle = "Risk-aversion task") -> g

ggsave(plot = g, filename = here(output_path, "Fig13_1_ExpChange_risk_aversion_bt_inrow.png"), width = 20.0, height = 6.0)
```


```{r, eval = FALSE}
# リスク追求が適応的な課題
#target_sim <- c("-10 vs -30", "0 vs -20", "10 vs -10", "20 vs 0", "30 vs 10", "40 vs 20")

target_sim <- c("-10 vs -30", "0 vs -20", "10 vs -10", "20 vs 0", "30 vs 10", "40 vs 20", "50 vs 30")

df_gene_longer %>% 
  dplyr::filter(generation == 4999) %>% # 最終世代のみ取り出す 
  dplyr::filter(task_exp %in% target_sim) %>% 
  dplyr::mutate(task_sd = paste0("Risk of Risky Option = ", sd1)) %>% 
  dplyr::filter(para == "bt") %>% 
  
  ggplot(aes(x = task_exp, y = mean_rate, color = para, group = para)) + 
  geom_linerange(aes(ymin = mean_rate - sd_rate, ymax = mean_rate + sd_rate), size = 1.4, position = position_dodge(width = 0.5)) + 
  geom_line(position = position_dodge(width=0.7), size = 1.2, linetype = "twodash") + 
  geom_point(size = 2.5, position = position_dodge(width=0.5), stroke = 2, shape = 21, fill = "white") + 
  scale_color_manual(name = "", values = c("#33A02C"), labels = expression(beta)) +
  scale_fill_manual(values = c("#33A02C")) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 11, angle = 30, hjust = 1), axis.text.y = element_text(size = 15), axis.title=element_text(size=14, face="bold"), strip.text.x = element_text(size = 15), legend.text = element_text(family = "serif", face = "italic"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(fill = "white"), legend.position = c(0.9, 0.6), legend.justification = c(1, 1)) + 
  coord_cartesian(ylim = c(0, 0.5)) + 
  scale_x_discrete(limits = c("-10 vs -30", "0 vs -20", "10 vs -10", "20 vs 0", "30 vs 10", "40 vs 20", "50 vs 30")) + 
  facet_grid(.~task_sd) + 
  labs(x = "Location of two distributions (risky vs sure)", y = "Parameter value in the last generation",
       subtitle = "Risk-seeking task") + guides(color = "none") -> g

ggsave(plot = g, filename = here(output_path, "Fig13_2_ExpChange_risk_seeking_bt_inrow.png"), width = 20.0, height = 6.0)
```

## Fig.14 複数$\beta$：9種類のシミュレーション結果


- 横軸: 世代、縦軸: 遺伝子の平均値(+SD)

```{r, eval = FALSE}
# 分布が正によっている課題群
target_sim <- c("multi1.0", "multi2.0", "multi3.0")

df_gene_multi_longer %>% 
  dplyr::filter(sim %in% target_sim) %>% 
  dplyr::filter(para == "bt") %>% 
  dplyr::mutate(
    sim_sort = 
      case_when(sim == "multi1.0" ~ "risk aversion/risk seeking = 2/2",
                sim == "multi2.0" ~ "risk aversion/risk seeking = 1/3",
                sim == "multi3.0" ~ "risk aversion/risk seeking = 3/1")
  ) %>% 
  
  ggplot(aes(x = generation, y = mean_rate)) + 
  geom_line(aes(x = generation, y = mean_rate, color = para), size = 1.2) + 
  geom_ribbon(aes(x = generation, ymin = mean_rate - mean_sd, ymax = mean_rate + mean_sd, fill = para), alpha = 0.6) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15), legend.text = element_text(family = "serif", face = "italic"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(color = "transparent", fill = "white"), legend.position = c(1, 0.4), legend.justification = c(1, 1)) + 
  facet_grid(.~sim_sort) + 
  labs(x= 'Generation', y= 'Parameter value', subtitle = 'Positively located simulation') + 
  scale_x_continuous(breaks = pretty) + 
  scale_color_manual(name = "", values = c("#33A02C"), labels = expression(beta)) +
  scale_fill_manual(name = "", values = c("#33A02C"), labels = expression(beta)) + 
  coord_cartesian(ylim = c(-0.02, 0.5)) -> g

ggsave(plot = g, filename = here(output_path, "Fig14_1_Evo_MultiTask_positive_bt.png"), width = 15.0, height = 6.0)
```



```{r, eval = FALSE}
# 分布が正によっている課題群
## multi 1.0のみを取り出す
target_sim <- c("multi1.0")

df_gene_multi_longer %>% 
  dplyr::filter(sim %in% target_sim) %>% 
  dplyr::filter(para == "bt") %>% 
  dplyr::mutate(
    sim_sort = 
      case_when(sim == "multi1.0" ~ "risk aversion/risk seeking = 2/2")
  ) %>% 
  
  ggplot(aes(x = generation, y = mean_rate)) + 
  geom_line(aes(x = generation, y = mean_rate, color = para), size = 1.2) + 
  geom_ribbon(aes(x = generation, ymin = mean_rate - mean_sd, ymax = mean_rate + mean_sd, fill = para), alpha = 0.6) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15), legend.text = element_text(family = "serif", face = "italic"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(color = "transparent", fill = "white"), legend.position = c(1, 0.4), legend.justification = c(1, 1)) + 
  facet_grid(.~sim_sort) + 
  labs(x= 'Generation', y= 'Parameter value', subtitle = 'Positively located simulation') + 
  scale_x_continuous(breaks = pretty) + 
  scale_color_manual(name = "", values = c("#33A02C"), labels = expression(beta)) +
  scale_fill_manual(name = "", values = c("#33A02C"), labels = expression(beta)) + 
  coord_cartesian(ylim = c(-0.02, 0.5)) -> g

ggsave(plot = g, filename = here(output_path, "Fig14_1_Evo_MultiTask_positive_bt_2-2.png"), width = 6.0, height = 6.0)
```


```{r, eval = FALSE}
# 分布が中心〜負によっている課題群
target_sim <- c("multi4.0", "multi5.0", "multi6.0")

df_gene_multi_longer %>% 
  dplyr::filter(sim %in% target_sim) %>% 
  dplyr::filter(para == "bt") %>% 
  dplyr::mutate(
    sim_sort = 
      case_when(sim == "multi4.0" ~ "risk aversion/risk seeking = 2/2",
                sim == "multi5.0" ~ "risk aversion/risk seeking = 1/3",
                sim == "multi6.0" ~ "risk aversion/risk seeking = 3/1")
  ) %>% 
  
  ggplot(aes(x = generation, y = mean_rate)) + 
  geom_line(aes(x = generation, y = mean_rate, color = para), size = 1.2) + 
  geom_ribbon(aes(x = generation, ymin = mean_rate - mean_sd, ymax = mean_rate + mean_sd, fill = para), alpha = 0.6) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15), legend.text = element_text(family = "serif", face = "italic"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(color = "transparent", fill = "white"), legend.position = c(1, 0.9), legend.justification = c(1, 1)) + 
  facet_grid(.~sim_sort) + 
  labs(x= 'Generation', y= 'Parameter value', subtitle = 'Centrally located simulation') + 
  scale_x_continuous(breaks = pretty) + 
  scale_color_manual(name = "", values = c("#33A02C"), labels =  expression(beta)) +
  scale_fill_manual(name = "", values = c("#33A02C"), labels = expression(beta)) + 
  coord_cartesian(ylim = c(-0.02, 0.5)) + guides(color = "none", fill = "none") -> g

ggsave(plot = g, filename = here(output_path, "Fig14_2_Evo_MultiTask_center_bt.png"), width = 15.0, height = 6.0)
```



```{r, eval = FALSE}
# 分布が負によっている課題群
target_sim <- c("multi7.0", "multi8.0", "multi9.0")

df_gene_multi_longer %>% 
  dplyr::filter(sim %in% target_sim) %>% 
  dplyr::filter(para == "bt") %>% 
  dplyr::mutate(
    sim_sort = 
      case_when(sim == "multi7.0" ~ "risk aversion/risk seeking = 2/2",
                sim == "multi8.0" ~ "risk aversion/risk seeking = 1/3",
                sim == "multi9.0" ~ "risk aversion/risk seeking = 3/1")
  ) %>% 
  
  ggplot(aes(x = generation, y = mean_rate)) + 
  geom_line(aes(x = generation, y = mean_rate, color = para), size = 1.2) + 
  geom_ribbon(aes(x = generation, ymin = mean_rate - mean_sd, ymax = mean_rate + mean_sd, fill = para), alpha = 0.6) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15), legend.text = element_text(family = "serif", face = "italic"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(color = "transparent", fill = "white"), legend.position = c(1, 0.9), legend.justification = c(1, 1)) + 
  facet_grid(.~sim_sort) + 
  labs(x= 'Generation', y= 'Parameter value', subtitle = 'Negatively located tasks') + 
  scale_x_continuous(breaks = pretty) + 
  scale_color_manual(name = "", values = c("#33A02C"), labels = expression(beta)) +
  scale_fill_manual(name = "", values = c("#33A02C"), labels = expression(beta)) + 
  coord_cartesian(ylim = c(-0.02, 0.5)) + guides(color = "none", fill = "none") -> g

ggsave(plot = g, filename = here(output_path, "Fig14_3_Evo_MultiTask_negative_bt.png"), width = 15.0, height = 6.0)
```


```{r, eval = FALSE}
# 分布が負によっている課題群
## multi 7.0のみを取り出す
target_sim <- c("multi7.0")

df_gene_multi_longer %>% 
  dplyr::filter(sim %in% target_sim) %>% 
  dplyr::filter(para == "bt") %>% 
  dplyr::mutate(
    sim_sort = 
      case_when(sim == "multi7.0" ~ "risk aversion/risk seeking = 2/2")
  ) %>% 
  
  ggplot(aes(x = generation, y = mean_rate)) + 
  geom_line(aes(x = generation, y = mean_rate, color = para), size = 1.2) + 
  geom_ribbon(aes(x = generation, ymin = mean_rate - mean_sd, ymax = mean_rate + mean_sd, fill = para), alpha = 0.6) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15), legend.text = element_text(family = "serif", face = "italic"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(color = "transparent", fill = "white"), legend.position = c(1, 0.9), legend.justification = c(1, 1)) + 
  facet_grid(.~sim_sort) + 
  labs(x= 'Generation', y= 'Parameter value', subtitle = 'Negatively located tasks') + 
  scale_x_continuous(breaks = pretty) + 
  scale_color_manual(name = "", values = c("#33A02C"), labels = expression(beta)) +
  scale_fill_manual(name = "", values = c("#33A02C"), labels = expression(beta)) + 
  coord_cartesian(ylim = c(-0.02, 0.5)) + guides(color = "none", fill = "none") -> g

ggsave(plot = g, filename = here(output_path, "Fig14_3_Evo_MultiTask_negative_bt_2-2.png"), width = 6.0, height = 6.0)
```


# その他論文に必要な情報

## 複数課題シミュレーションのlocation

- 課題の構造
- Posi1：sim1 (リスク回避2/4)

    - Task 1: N(30, 20) > N(10, 5)（リスク追求が有利）
    - Task 2: N(20, 20) > N(0, 5)（リスク追求が有利）
    - Task 3: N(10, 20) < N(30, 5)（リスク回避が有利）
    - Task 4: N(0, 20) < N(20, 5)（リスク回避が有利）
    
- Posi2：sim2 (リスク回避1/4)

    - Task 1: N(30, 20) > N(10, 5)（リスク追求が有利）
    - Task 2: N(20, 20) > N(0, 5)（リスク追求が有利）
    - Task 3: N(10, 20) > N(-10, 5)（リスク追求が有利）
    - Task 4: N(10, 20) < N(30, 5)（リスク回避が有利）
    
- Posi3：sim3 (リスク回避3/4)

    - Task 1: N(30, 20) > N(10, 5)（リスク追求が有利）
    - Task 2: N(10, 20) < N(30, 5)（リスク回避が有利）
    - Task 3: N(0, 20) < N(20, 5)（リスク回避が有利）
    - Task 4: N(-10, 20) < N(10, 5)（リスク回避が有利）

- Cent1：sim4（リスク回避2/4）

    - Task 1: N(10, 20) > N(-10, 5)（リスク追求が有利）
    - Task 2: N(0, 20) > N(-20, 5)（リスク追求が有利）
    - Task 3: N(-10, 20) < N(10, 5)（リスク回避が有利）
    - Task 4: N(-20, 20) < N(0, 5)（リスク回避が有利）

- Cent2：sim5 (リスク回避1/4)

    - Task 1: N(10, 20) > N(-10, 5)（リスク追求が有利）
    - Task 2: N(0, 20) > N(-20, 5)（リスク追求が有利）
    - Task 3: N(-10, 20) > N(-30, 5)（リスク追求が有利）
    - Task 4: N(-10, 20) < N(10, 5)（リスク回避が有利）

- Cent3：sim6 (リスク回避3/4)

    - Task 1: N(10, 20) > N(-10, 5)（リスク追求が有利）
    - Task 2: N(-10, 20) < N(10, 5)（リスク回避が有利）
    - Task 3: N(-20, 20) < N(0, 5)（リスク回避が有利）
    - Task 4: N(-30, 20) < N(-10, 5)（リスク回避が有利）
    
    
- Nega1：sim7（リスク回避2/4）

    - Task 1: N(-10, 20), N(-30, 5)（リスク追求が有利）
    - Task 2: N(-20, 20), N(-40, 5)（リスク追求が有利）
    - Task 3: N(-30, 20), N(-10, 5)（リスク回避が有利）
    - Task 4: N(-40, 20), N(-20, 5)（リスク回避が有利）


- Nega2：sim8（リスク回避1/4）

    - Task 1: N(-10, 20) > N(-30, 5)（リスク追求が有利）
    - Task 2: N(-20, 20) > N(-40, 5)（リスク追求が有利）
    - Task 3: N(-30, 20) > N(-50, 5)（リスク追求が有利）
    - Task 4: N(-30, 20) < N(-10, 5)（リスク回避が有利）


- Nega3：sim9（リスク回避3/4）

    - Task 1: N(-10, 20), N(-30, 5)（リスク追求が有利）
    - Task 2: N(-30, 20), N(-10, 5)（リスク回避が有利）
    - Task 3: N(-40, 20), N(-20, 5)（リスク回避が有利）
    - Task 4: N(-50, 20), N(-30, 5)（リスク回避が有利）


- Posi 1

```{r}
TaskStrucFunc1(30, 20, 10, 5) + TaskStrucFunc1(20, 20, 0, 5) + TaskStrucFunc1(10, 20, 30, 5) + TaskStrucFunc1(0, 20, 20, 5) + plot_annotation(tag_levels = "1")
```

```{r}
# 各正規分布について、0以下の領域の大きさを計算する
# 全体を2として、その領域が占める割合を計算する
t1 <- (pnorm(0, 30, 20) + pnorm(0, 10, 5))/2
t2 <- (pnorm(0, 20, 20) + pnorm(0, 0, 5))/2
t3 <- (pnorm(0, 10, 20) + pnorm(0, 30, 5))/2
t4 <- (pnorm(0, 0, 20) + pnorm(0, 20, 5))/2

# 4課題の平均
(t1 + t2 + t3 + t4)/4
```

- Posi 2

```{r}
TaskStrucFunc1(30, 20, 10, 5) + TaskStrucFunc1(20, 20, 0, 5) + TaskStrucFunc1(10, 20, -10, 5) + TaskStrucFunc1(10, 20, 30, 5) + plot_annotation(tag_levels = "1")
```

```{r}
# 各正規分布について、0以下の領域の大きさを計算する
# 全体を2として、その領域が占める割合を計算する
t1 <- (pnorm(0, 30, 20) + pnorm(0, 10, 5))/2
t2 <- (pnorm(0, 20, 20) + pnorm(0, 0, 5))/2
t3 <- (pnorm(0, 10, 20) + pnorm(0, -10, 5))/2
t4 <- (pnorm(0, 10, 20) + pnorm(0, 30, 5))/2

# 4課題の平均
(t1 + t2 + t3 + t4)/4
```

- Posi3

```{r}
TaskStrucFunc1(30, 20, 10, 5) + TaskStrucFunc1(10, 20, 30, 5) + TaskStrucFunc1(0, 20, 20, 5) + TaskStrucFunc1(-10, 20, 10, 5) + plot_annotation(tag_levels = "1")
```

```{r}
# 各正規分布について、0以下の領域の大きさを計算する
# 全体を2として、その領域が占める割合を計算する
t1 <- (pnorm(0, 30, 20) + pnorm(0, 10, 5))/2
t2 <- (pnorm(0, 10, 20) + pnorm(0, 30, 5))/2
t3 <- (pnorm(0, 0, 20) + pnorm(0, 20, 5))/2
t4 <- (pnorm(0, -10, 20) + pnorm(0, 10, 5))/2

# 4課題の平均
(t1 + t2 + t3 + t4)/4
```


- Cent 1


```{r}
TaskStrucFunc1(10, 20, -10, 5) + TaskStrucFunc1(0, 20, -20, 5) + TaskStrucFunc1(-10, 20, 10, 5) + TaskStrucFunc1(-20, 20, 0, 5) + plot_annotation(tag_levels = "1")
```

```{r}
# 各正規分布について、0以下の領域の大きさを計算する
# 全体を2として、その領域が占める割合を計算する
t1 <- (pnorm(0, 10, 20) + pnorm(0, -10, 5))/2
t2 <- (pnorm(0, 0, 20) + pnorm(0, -20, 5))/2
t3 <- (pnorm(0, -10, 20) + pnorm(0, 10, 5))/2
t4 <- (pnorm(0, -20, 20) + pnorm(0, 0, 5))/2

# 4課題の平均
(t1 + t2 + t3 + t4)/4
```

- Cent 2

```{r}
TaskStrucFunc1(10, 20, -10, 5) + TaskStrucFunc1(0, 20, -20, 5) + TaskStrucFunc1(-10, 20, -30, 5) + TaskStrucFunc1(-10, 20, 10, 5) + plot_annotation(tag_levels = "1")
```

```{r}
# 各正規分布について、0以下の領域の大きさを計算する
# 全体を2として、その領域が占める割合を計算する
t1 <- (pnorm(0, 10, 20) + pnorm(0, -10, 5))/2
t2 <- (pnorm(0, 0, 20) + pnorm(0, -20, 5))/2
t3 <- (pnorm(0, -10, 20) + pnorm(0, -30, 5))/2
t4 <- (pnorm(0, -10, 20) + pnorm(0, 10, 5))/2

# 4課題の平均
(t1 + t2 + t3 + t4)/4
```

- Cent3


```{r}
TaskStrucFunc1(10, 20, -10, 5) + TaskStrucFunc1(-10, 20, 10, 5) + TaskStrucFunc1(-20, 20, 0, 5) + TaskStrucFunc1(-30, 20, -10, 5) + plot_annotation(tag_levels = "1")
```

```{r}
# 各正規分布について、0以下の領域の大きさを計算する
# 全体を2として、その領域が占める割合を計算する
t1 <- (pnorm(0, 10, 20) + pnorm(0, -10, 5))/2
t2 <- (pnorm(0, -10, 20) + pnorm(0, 10, 5))/2
t3 <- (pnorm(0, -20, 20) + pnorm(0, 0, 5))/2
t4 <- (pnorm(0, -30, 20) + pnorm(0, -10, 5))/2

# 4課題の平均
(t1 + t2 + t3 + t4)/4
```


- Nega1


```{r}
TaskStrucFunc1(-10, 20, -30, 5) + TaskStrucFunc1(-20, 20, -40, 5) + TaskStrucFunc1(-30, 20, -10, 5) + TaskStrucFunc1(-40, 20, -20, 5) + plot_annotation(tag_levels = "1")
```

```{r}
# 各正規分布について、0以下の領域の大きさを計算する
# 全体を2として、その領域が占める割合を計算する
t1 <- (pnorm(0, -10, 20) + pnorm(0, -30, 5))/2
t2 <- (pnorm(0, -20, 20) + pnorm(0, -40, 5))/2
t3 <- (pnorm(0, -30, 20) + pnorm(0, -10, 5))/2
t4 <- (pnorm(0, -40, 20) + pnorm(0, -20, 5))/2

# 4課題の平均
(t1 + t2 + t3 + t4)/4
```


- Nega2


```{r}
TaskStrucFunc1(-10, 20, -30, 5) + TaskStrucFunc1(-20, 20, -40, 5) + TaskStrucFunc1(-30, 20, -50, 5) + TaskStrucFunc1(-30, 20, -10, 5) + plot_annotation(tag_levels = "1")
```

```{r}
# 各正規分布について、0以下の領域の大きさを計算する
# 全体を2として、その領域が占める割合を計算する
t1 <- (pnorm(0, -10, 20) + pnorm(0, -30, 5))/2
t2 <- (pnorm(0, -20, 20) + pnorm(0, -40, 5))/2
t3 <- (pnorm(0, -30, 20) + pnorm(0, -50, 5))/2
t4 <- (pnorm(0, -30, 20) + pnorm(0, -10, 5))/2

# 4課題の平均
(t1 + t2 + t3 + t4)/4
```


- Nega3

```{r}
TaskStrucFunc1(-10, 20, -30, 5) + TaskStrucFunc1(-30, 20, -10, 5) + TaskStrucFunc1(-40, 20, -20, 5) + TaskStrucFunc1(-50, 20, -30, 5) + plot_annotation(tag_levels = "1")
```

```{r}
# 各正規分布について、0以下の領域の大きさを計算する
# 全体を2として、その領域が占める割合を計算する
t1 <- (pnorm(0, -10, 20) + pnorm(0, -30, 5))/2
t2 <- (pnorm(0, -30, 20) + pnorm(0, -10, 5))/2
t3 <- (pnorm(0, -40, 20) + pnorm(0, -20, 5))/2
t4 <- (pnorm(0, -50, 20) + pnorm(0, -30, 5))/2

# 4課題の平均
(t1 + t2 + t3 + t4)/4
```


## 複数課題シミュレーションの分布図（全て）

```{r}
mean1 <- c(30, 20, 10, 0, 
           30, 20, 10, 10, 
           30, 10, 0, -10, 
           10, 0, -10, -20, 
           10, 0, -10, -10,
           10, -10, -20, -30,
           -10, -20, -30, -40,
           -10, -20, -30, -30,
           -10, -30, -40, -50)

sd1 <- rep(20, times = 4 * 9)

mean2 <- c(10, 0, 30, 20,
           10, 0, -10, 30,
           10, 30, 20, 10,
           -10, -20, 10, 0,
           -10, -20, -30, 10,
           -10, 10, 0, -10,
           -30, -40, -10, -20,
           -30, -40, -50, -10,
           -30, -10, -20, -30)

sd2 <- rep(5, times = 4 * 9)

names <- rep(c("Posi 2/4", "Posi 1/4", "Posi 3/4", "Cent 2/4", "Cent 1/4", "Cent 3/4", "Nega 2/4", "Nega 1/4", "Nega 3/4"), each = 4)

n <- rep(1:4, times = 9)

task_struct <- tibble(
  m1 = mean1,
  sd1 = sd1,
  m2 = mean2,
  sd2 = sd2,
  n = n,
  names = names
)

ggplot(data = data.frame(x = c(-70, 70)), aes(x)) + 
    stat_function(data = task_struct, fun = dnorm, args = list(mean = task_struct$m1, sd = task_struct$sd1), color = "#FF7F00", size = 1.0, geom="area", fill = "#FF7F00", alpha = 0.3) + 
    stat_function(data = task_struct, fun = dnorm, args = list(mean = task_struct$m2, sd = task_struct$sd2), color = "#1F78B4", size = 1.0, geom="area", fill = "#1F78B4", alpha = 0.3) + 
    geom_vline(xintercept = 0, color = "black", size = 1.3) + 
    geom_segment(data = task_struct, aes(x = m1, xend = task_struct$m1, y = -0.002, yend = dnorm(task_struc$m1, task_struct$m1, task_struct$sd1)), linetype = "dashed", color = "#FF7F00", size = 0.7) +
    geom_segment(data = task_struct, aes(x = m2, xend = task_struct$m2, y = -0.002, yend = dnorm(task_struct$m2, task_struct$m2, task_struct$sd2)), linetype = "dashed", color = "#1F78B4", size = 0.7) +
    theme_classic() + 
    theme(axis.text.x = element_text(size = 18, colour="black"), axis.line=element_line(colour="black", size=1.3, lineend="square"), axis.title=element_text(size=14, face="bold")) + 
    labs(x = "Payoff", y = "") + 
    scale_y_continuous(breaks = NULL) + 
    scale_x_continuous(breaks = c(-60, -30, 0, 30, 60)) +
    coord_cartesian(xlim = c(-60, 60)) + facet_wrap(names~n)
```

```{r}
# 36個の分布
p1_1 <- TaskStrucFunc3(30, 20, 10, 5); p1_2 <- TaskStrucFunc3(20, 20, 0, 5); p1_3 <- TaskStrucFunc3(10, 20, 30, 5); p1_4 <- TaskStrucFunc3(0, 20, 20, 5) 

p1 <- p1_1 + p1_2 + p1_3 + p1_4 + plot_layout(ncol = 4) 

p2_1 <- TaskStrucFunc3(30, 20, 10, 5); p2_2 <- TaskStrucFunc3(20, 20, 0, 5); p2_3 <- TaskStrucFunc3(10, 20, -10, 5); p2_4 <- TaskStrucFunc3(10, 20, 30, 5)

p2 <- p2_1 + p2_2 + p2_3 + p2_4 + plot_layout(ncol = 4)

p3_1 <- TaskStrucFunc3(30, 20, 10, 5); p3_2 <- TaskStrucFunc3(10, 20, 30, 5); p3_3 <- TaskStrucFunc3(0, 20, 20, 5); p3_4 <- TaskStrucFunc3(-10, 20, 10, 5)

p3 <- p3_1 + p3_2 + p3_3 + p3_4 + plot_layout(ncol = 4)

# 正に位置している課題図を保存
gg_p <- p1 / p2 / p3 + plot_annotation(title = "Positively-located tasks, row1 = 2/4, row2 = 1/4, row3 = 3/4 (risk-aversion task)")
ggsave(filename = here(output_path, "MultipleTask_Struct_p.png"), plot = gg_p, width = 20, height = 9)
rm(list = ls()[stringr::str_detect(string = ls(), pattern = "^p1|^p2|^p3")])

c1_1 <- TaskStrucFunc3(10, 20, -10, 5); c1_2 <- TaskStrucFunc3(0, 20, -20, 5); c1_3 <- TaskStrucFunc3(-10, 20, 10, 5); c1_4 <- TaskStrucFunc3(-20, 20, 0, 5)

c1 <- c1_1 + c1_2 + c1_3 + c1_4 + plot_layout(ncol = 4)

c2_1 <- TaskStrucFunc3(10, 20, -10, 5); c2_2 <- TaskStrucFunc3(0, 20, -20, 5); c2_3 <- TaskStrucFunc3(-10, 20, -30, 5); c2_4 <- TaskStrucFunc3(-10, 20, 10, 5)

c2 <- c2_1 + c2_2 + c2_3 + c2_4 + plot_layout(ncol = 4)

c3_1 <- TaskStrucFunc3(10, 20, -10, 5); c3_2 <- TaskStrucFunc3(-10, 20, 10, 5); c3_3 <- TaskStrucFunc3(-20, 20, 0, 5); c3_4 <- TaskStrucFunc3(-30, 20, -10, 5)

c3 <- c3_1 + c3_2 + c3_3 + c3_4 + plot_layout(ncol = 4)

# 中央に位置している課題図を保存
gg_c <- c1 / c2 / c3 + plot_annotation(title = "Centrally-located tasks, row1 = 2/4, row2 = 1/4, row3 = 3/4 (risk-aversion task)")
ggsave(filename = here(output_path, "MultipleTask_Struct_c.png"), plot = gg_c, width = 20, height = 9)
rm(list = ls()[stringr::str_detect(string = ls(), pattern = "^c1|^c2|^c3")])

n1_1 <- TaskStrucFunc3(-10, 20, -30, 5); n1_2 <- TaskStrucFunc3(-20, 20, -40, 5); n1_3 <- TaskStrucFunc3(-30, 20, -10, 5); n1_4 <- TaskStrucFunc3(-40, 20, -20, 5) 

n1 <- n1_1 + n1_2 + n1_3 + n1_4 + plot_layout(ncol = 4)

n2_1 <- TaskStrucFunc3(-10, 20, -30, 5); n2_2 <- TaskStrucFunc3(-20, 20, -40, 5); n2_3 <- TaskStrucFunc3(-30, 20, -50, 5); n2_4 <- TaskStrucFunc3(-30, 20, -10, 5)

n2 <- n2_1 + n2_2 + n2_3 + n2_4 + plot_layout(ncol = 4)

n3_1 <- TaskStrucFunc3(-10, 20, -30, 5); n3_2 <- TaskStrucFunc3(-30, 20, -10, 5); n3_3 <- TaskStrucFunc3(-40, 20, -20, 5); n3_4 <- TaskStrucFunc3(-50, 20, -30, 5)

n3 <- n3_1 + n3_2 + n3_3 + n3_4 + plot_layout(ncol = 4)

# 負に位置している課題図を保存
gg_n <- n1 / n2 / n3 + plot_annotation(title = "Negatively-located tasks, row1 = 2/4, row2 = 1/4, row3 = 3/4 (risk-aversion task)")
ggsave(filename = here(output_path, "MultipleTask_Struct_n.png"), plot = gg_n, width = 20, height = 9)
rm(list = ls()[stringr::str_detect(string = ls(), pattern = "^n1|^n2|^n3")])

```


```{r}
# 2/2課題だけ保存する

# 正に位置する課題
p1_1 <- TaskStrucFunc3(30, 20, 10, 5); p1_2 <- TaskStrucFunc3(20, 20, 0, 5); p1_3 <- TaskStrucFunc3(10, 20, 30, 5); p1_4 <- TaskStrucFunc3(0, 20, 20, 5)

p1 <- p1_1 + p1_2 + p1_3 + p1_4 + plot_layout(ncol = 4) 
ggsave(filename = here(output_path, "MultipleTask_Struct_p1.png"), plot = p1, width = 20, height = 4)


# 負に位置する課題
n1_1 <- TaskStrucFunc3(-10, 20, -30, 5); n1_2 <- TaskStrucFunc3(-20, 20, -40, 5); n1_3 <- TaskStrucFunc3(-30, 20, -10, 5); n1_4 <- TaskStrucFunc3(-40, 20, -20, 5) 

n1 <- n1_1 + n1_2 + n1_3 + n1_4 + plot_layout(ncol = 4)
ggsave(filename = here(output_path, "MultipleTask_Struct_n1.png"), plot = n1, width = 20, height = 4)
```




## Fig.X1 単一$\beta$：6つの典型的な結果 進化


```{r, eval = FALSE}
# リスク回避が適応的な課題

sim_name <- c("20.5.0.20", "0.5.-20.20", "-20.5.-40.20")

df_gene_longer %>% 
  dplyr::filter(sim %in% sim_name) %>% # 3つのsim_nameのみを取り出す
  dplyr::filter(para == "bt") %>% 
  dplyr::mutate(
    sim_sort = paste0('N(', m2, ',', sd2, ') vs N(', m1, ',', sd1, ')')
  ) %>% 

  ggplot(aes(x = generation, y = mean_rate)) + 
  geom_line(aes(x = generation, y = mean_rate, color = para), size = 1.2) + 
  geom_ribbon(aes(x = generation, ymin = mean_rate - mean_sd, ymax = mean_rate + mean_sd, fill = para), alpha = 0.6) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15), legend.text = element_text(family = "serif", face = "italic"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(color = "transparent", fill = "white"), legend.position = c(1, 0.35), legend.justification = c(1, 1)) + 
  facet_grid(.~sim_sort) + 
  labs(x= 'Generation', y= 'Mean parameter value', subtitle = 'Risk-aversion task') + 
  scale_x_continuous(breaks = pretty) + 
  scale_color_manual(name = "", values = c("#33A02C"), labels = expression(beta)) +
  scale_fill_manual(name = "", values = c("#33A02C"), labels = expression(beta)) + 
  coord_cartesian(ylim = c(-0.02, 0.5)) -> g

ggsave(plot = g, filename = here(output_path, "FigX1_1_Evo_risk_aversion_6_bt.png"), width = 15.0, height = 6.0)
```


```{r, eval = FALSE}
# リスク追求が適応的な課題

sim_name <- c("20.5.40.20", "0.5.20.20", "-20.5.0.20")

df_gene_longer %>% 
  dplyr::filter(sim %in% sim_name) %>% # 3つのsim_nameのみを取り出す
  dplyr::filter(para == "bt") %>% 
  dplyr::mutate(
    sim_sort = paste0('N(', m2, ',', sd2, ') vs N(', m1, ',', sd1, ')')
  ) %>% 

  ggplot(aes(x = generation, y = mean_rate)) + 
  geom_line(aes(x = generation, y = mean_rate, color = para), size = 1.2) + 
  geom_ribbon(aes(x = generation, ymin = mean_rate - mean_sd, ymax = mean_rate + mean_sd, fill = para), alpha = 0.6) + 
  my_theme2 + 
  theme(axis.text.x = element_text(size = 15), axis.text.y = element_text(size = 15), axis.title=element_text(size = 20, face="bold"), strip.text.x = element_text(size = 15), legend.text = element_text(family = "serif", face = "italic"), legend.background = element_rect(fill = "transparent"), legend.key = element_rect(color = "transparent", fill = "white"), legend.position = c(1, 0.9), legend.justification = c(1, 1)) + 
  facet_grid(.~sim_sort) + 
  labs(x= 'Generation', y= 'Mean parameter value', subtitle = 'Risk-seeking task') + 
  scale_x_continuous(breaks = pretty) + 
  scale_color_manual(name = "", values = c("#33A02C"), labels = expression(beta)) +
  scale_fill_manual(name = "", values = c("#33A02C"), labels = expression(beta)) + 
  coord_cartesian(ylim = c(-0.02, 0.5)) + guides(color = FALSE, fill = FALSE) -> g

ggsave(plot = g, filename = here(output_path, "FigX1_2_Evo_risk_seeking_6_bt.png"), width = 15.0, height = 6.0)
```



## Fig.X4 $\beta$の値によってどれくらいの差が生まれるのか


```{r}
# 分布が正によっている課題群
target_sim <- c("multi1.0", "multi2.0", "multi3.0")

df_gene_multi_longer %>% 
  dplyr::filter(sim %in% target_sim) %>% 
  dplyr::filter(para == "bt") %>% 
  dplyr::filter(generation == 4999) %>% 
  dplyr::mutate(
    sim_sort = 
      case_when(sim == "multi1.0" ~ "2/4 risk-aversion task",
                sim == "multi2.0" ~ "1/4 risk-aversion task",
                sim == "multi3.0" ~ "3/4 risk-aversion task")
  )
```


```{r}
# 分布が中心〜負によっている課題群
target_sim <- c("multi4.0", "multi5.0", "multi6.0")

df_gene_multi_longer %>% 
  dplyr::filter(sim %in% target_sim) %>% 
  dplyr::filter(para == "bt") %>% 
  dplyr::filter(generation == 4999) %>% 
  dplyr::mutate(
    sim_sort = 
      case_when(sim == "multi4.0" ~ "2/4 risk-aversion task",
                sim == "multi5.0" ~ "1/4 risk-aversion task",
                sim == "multi6.0" ~ "3/4 risk-aversion task")
  )

```

```{r}
# 分布が負によっている課題群
target_sim <- c("multi7.0", "multi8.0", "multi9.0")

df_gene_multi_longer %>% 
  dplyr::filter(sim %in% target_sim) %>% 
  dplyr::filter(para == "bt") %>% 
  dplyr::filter(generation == 4999) %>% 
  dplyr::mutate(
    sim_sort = 
      case_when(sim == "multi7.0" ~ "2/4 risk-aversion task",
                sim == "multi8.0" ~ "1/4 risk-aversion task",
                sim == "multi9.0" ~ "3/4 risk-aversion task")
  )
```


```{r} 
# どれくらいの差なのか？
# Softmax関数を描いてみる

label_beta <- c("0.25(initial mean)", "0.3004(posi 2/4)", "0.4234(cent 2/4)", "0.4430(nega 2/4)")

tibble(
    x = seq(from = -60, to = 60, by = 0.1)
  ) %>% 
  tidyr::expand(crossing(x), beta = c(0.3004, 0.4234, 0.4430, 0.250)) %>% 
  dplyr::mutate(p = softmax(x = x, bt = beta)) %>% 
  
  ggplot(aes(x = x, y = p)) + geom_line(aes(color = as.factor(beta)), size = 1.3) + 
  labs(x = "V(1) - V(2)", y = "p(risky option)", color = expression(beta)) + 
  my_theme2 + 
  theme(legend.text = element_text(size = 10.0), legend.title = element_text(size = 12.0)) + 
  scale_color_viridis_d(labels = label_beta) + 
  coord_cartesian(ylim = c(0,1)) -> g

ggsave(plot = g, filename = here(output_path, "FigX4_softmax_bt.png"), width = 8.0, height = 6.0)

```

```{r}
tibble(
    x = seq(from = -60, to = 60, by = 0.1)
  ) %>% 
  tidyr::expand(crossing(x), beta = c(0.3004, 0.4234, 0.4430, 0.250)) %>% 
  dplyr::mutate(
    p = softmax(x = x, bt = beta),
    beta_n = case_when(
      beta == 0.3004 ~ "posi",
      beta == 0.4234 ~ "cent",
      beta == 0.4430 ~ "nega",
      beta == 0.25 ~ "init"
    )) %>% 
  tidyr::pivot_wider(id_cols = c(x), names_from = beta_n, values_from = p) %>% 
  dplyr::mutate(
    posi_init = posi - init,
    cent_init = cent - init,
    nega_init = nega - init,
    nega_posi = nega - posi
  ) %>% 
  tidyr::pivot_longer(cols = c(posi_init, cent_init, nega_init, nega_posi), names_to = "compare", values_to = "p") %>% 
  
  ggplot(aes(x = x, y = p, )) + geom_line(aes(color = compare), size = 1.3) +
  labs(x = "V(1) - V(2)", y = "difference in p(risky option)") + 
  my_theme2 + 
  theme(legend.text = element_text(size = 13.0), legend.title = element_text(size = 15.0)) + 
  scale_color_viridis_d() + 
  coord_cartesian(ylim = c(-0.2, 0.2)) -> g
  
ggsave(plot = g, filename = here(output_path, "FigX5_softmax_difference_bt.png"), width = 8.0, height = 6.0)
```


# 古い図

## Fig.4 複数：進化の結果

  
- 横軸: 世代、縦軸: 遺伝子の平均値(+SD)


```{r, eval = FALSE}
# 2/2の正 & 負の課題
target_sim <- c("P_2/2", "N_2/2")

g <- VisEvol_Multi_Para_RunMean_facetSim(df_gene_multi_longer, target_sim, "alpha", "loc", "")

ggsave(plot = g, filename = here(output_path, "Fig4_Evo_apan_Multi_PosiNega.png"), width = 10.0, height = 6.0)
```

```{r, eval = FALSE}
# 2/2の正 & 中央、負の課題 for MultiRandTask
target_sim <- c("P_2/2", "C_2/2", "N_2/2")

g <- VisEvol_Multi_Para_RunMean_facetSim(df_gene_multi_longer, target_sim, "alpha", "loc", "")

ggsave(plot = g, filename = here(output_path, "Evo_apan_Multi_PosiCentNega.png"), width = 13.0, height = 6.0)
```



## Fig.8 複数：4課題のリスク回避率

- 2/2課題を抜き出す
- 横軸: 世代、縦軸: リスク回避率の平均値(+SD)


```{r, eval = FALSE}
# 正の課題シミュレーション
# 2/2課題を抜き出す

target_sim <- c("P_2/2")

g <- VisEvol_Multi_RiskAversion_RunMean_facetTask(df_gene_task_riskaversion, target_sim, "Positively located simulation")

ggsave(plot = g, filename = here(output_path, "Fig8.1_Evo_RiskAversion_Multi_Positive.png"), width = 18.0, height = 6.0)
```


```{r, eval = FALSE}
# 負の課題シミュレーション
# 2/2課題を抜き出す

target_sim <- c("N_2/2")

g <- VisEvol_Multi_RiskAversion_RunMean_facetTask(df_gene_task_riskaversion, target_sim, "Positively located simultion")

ggsave(plot = g, filename = here(output_path, "Fig8.2_Evo_RiskAversion_Multi_Negative.png"), width = 18.0, height = 6.0)
```


## Fig.9 複数：エージェントの学習ダイナミクス

- 横軸: 試行、縦軸: リスク回避率
- パネル：課題 * 世代


```{r}
g <- VisTrial_Multi_RiskAversion_facetTask(df_trialP22_meanSD, "Positively located simulation")

ggsave(plot = g, filename = here(output_path, "Fig9.1_Trial_RiskAversion_MultiTask_Positive.png"), width = 18.0, height = 10.0)
```

```{r}
g <- VisTrial_Multi_RiskAversion_facetTask(df_trialN22_meanSD, "Negatively located simulation")

ggsave(plot = g, filename = here(output_path, "Fig9.2_Trial_RiskAversion_MultiTask_Negative.png"), width = 18.0, height = 10.0)
```




# Session Info

- RStudio Version：1.3.1093
    
```{r, eval = FALSE}
RStudio.Version()$version
```

- Packages

```{r}
sessionInfo()
```

